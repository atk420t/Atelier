(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{339:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[a("TOC",{class:"table-of-contents",attrs:{"list-type":"ul","include-level":[2,3]}},[a("template",{slot:"header"}),a("template",{slot:"footer"})],2)],1),s._v(" "),a("p",[s._v("自学python，从最熟悉的网站搭建入手。记录一下用nginx部署的过程。请注意："),a("strong",[s._v("本文参考了网上资源以及作者自身实践整理而成")]),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"使用环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用环境","aria-hidden":"true"}},[s._v("#")]),s._v(" 使用环境")]),s._v(" "),a("ul",[a("li",[s._v("ubuntu 16.04")]),s._v(" "),a("li",[s._v("python 2.7")])]),s._v(" "),a("h2",{attrs:{id:"准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作","aria-hidden":"true"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),a("ul",[a("li",[s._v("首先是安装pip：")])]),s._v(" "),a("p",[s._v("请把权限切成"),a("em",[s._v("超级用户")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" -i  \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" python-pip \n")])])]),a("ul",[a("li",[s._v("其次安装uwsgi：")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("pip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" uwsgi --upgrade  \n")])])]),a("p",[s._v("安装完uwsgi之后可以进行测试——创建一个python文件夹并创建test.py,内容如下：")]),s._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /python/test.py")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("application")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" start_response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    start_response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'200 OK'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'text/html'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello World"')]),s._v(" \n")])])]),a("p",[s._v("然后在终端运行：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("uwsgi --http :8001 --wsgi-file /python/test.py \n")])])]),a("p",[s._v('并从浏览器访问ip:8001（例如192.168.199.202:8001），可以看到浏览器输出"Hello World"。至此，uwsgi安装完成。')]),s._v(" "),a("ul",[a("li",[s._v("安装Django：\n由于我使用的是python2.7，因此django的版本应低于2，否则会安装失败。")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("pip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"django<2"')]),s._v(" \n")])])]),a("p",[s._v("然后用Django创建一个项目，用于之后部署：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cd")]),s._v(" /python\ndjango-admin startproject mysite \n")])])]),a("p",[s._v("使用tree命令可以观察项目的树状结构：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v(".")]),s._v("\n├── manage.py\n└── mysite\n    ├── __init__.py\n    ├── settings.py\n    ├── urls.py\n    └── wsgi.py\n1 directory, 5 files \n")])])]),a("p",[s._v("其中*/python/mysite/mysite/wsgi.py*即是本项目的入口文件（形同上面测试uwsgi时创建的test.py），后面部署时会用到。 接着测试一下django项目是否可以正常运行：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cd")]),s._v(" /python/mysite\npython manage.py runserver 0.0.0.0:8000 \n")])])]),a("p",[s._v('用浏览器访问服务器ip:8000（例如192.168.199.202:8000）发现报错提示"Disallowed Host at /,这是因为'),a("em",[s._v("mysite/settings.py")]),s._v("中的ALLOWED_HOSTS中一栏的参数为空。用vim打开并填上'localhost'和服务器ip然后保存，再次runserver即可看到Django的It worked!成功提示。")]),s._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysite/settings.py")]),s._v("\n\nDEBUG "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("\nALLOWED_HOSTS "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.199.202'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Application definition ")]),s._v("\n")])])]),a("ul",[a("li",[s._v("安装Nginx：\n我使用Ubuntu的软件包管理器进行安装，安装完毕之后Nginx的配置文件在*/etc/nginx/nginx.conf*。")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx \n")])])]),a("h2",{attrs:{id:"部署步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署步骤","aria-hidden":"true"}},[s._v("#")]),s._v(" 部署步骤")]),s._v(" "),a("ul",[a("li",[s._v("配置uwsgi：\n在安装uwsgi的准备过程中，我们曾测试过uwsgi是否正常运行，应用到了uwsgi的启动命令。但是如果每次启动网站都这么做就太麻烦了，所以可以创建ini配置文件来保存启动命令。\n在你喜欢的位置创建ini文件。我是在*/python/uwsgi.ini.d*下创建的，内容如下：")])]),s._v(" "),a("div",{staticClass:"language-vim extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[s._v("# "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("python")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("uwsgi"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("ini"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("d")]),s._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("uwsgi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nsocket "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9001")]),s._v("\nmaster "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" true "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("主进程\nvhosts "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" true "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("多站模式\nno"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("site "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" true "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("多站模式时不设置入口模块和文件\nworkers "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("子进程数\nreload"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("mercy "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nvacuum "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" true "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("退出、重启时清理文件\nmax"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("requests "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\nlimit"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("buffer")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30000")]),s._v("\npidfile "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("uwsgi9001"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("pid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("用来启动停止进程\ndaemonize "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("python")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("uwsgi"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("ini"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("d")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("uwsgi9001"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("用来记录启动日志 \n")])])]),a("ul",[a("li",[s._v("配置Nginx：\n打开nginx的配置文件*/etc/nginx/nginx.conf*，查阅http{}模块，很容易发现服务器配置文件应写在*/etc/nginx/conf.d*下，以.conf为后缀：")])]),s._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Virtual Host Configs")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sites"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("enabled"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n")])])]),a("p",[s._v("于是我们在/etc/nginx/conf.d创建一个mysite.conf文件，写入如下内容：")]),s._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".199")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".202")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" uwsgi_params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            uwsgi_pass "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9001")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            uwsgi_param UWSGI_CHDIR "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("python"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysite"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            uwsgi_param UWSGI_SCRIPT mysite"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("wsgi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),s._v("m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n")])])]),a("p",[s._v("其中，server_name是你的服务器ip（实际生产环境中是域名），uwsgi_pass是nginx接收请求后转交给uwsgi处理经过的端口，需要与第5步中的ini内设置的端口一致，UWSGI_CHDIR是项目的根目录，UWSGI_SCRIPT是项目入口文件相对于项目的路径（'.'表示一个层级）。设置完成之后，在终端重启nginx以及运行uwsgi：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx reload "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" uwsgi --ini /python/uwsgi.ini.d/uwsgi9001.ini \n")])])]),a("p",[s._v('然后在浏览器中访问服务器ip，却发现显示"Internal Server Error"报错信息。因为nginx顺利重启，所以错误应该不在于nginx，有可能是uwsgi的问题。于是我们去查看uwsgi的启动日志（配置环境应当养成查看日志的习惯），前面uwsgi的配置中，日志放在*/python/uwsgi.ini.d/uwsgi9001.log*。')]),s._v(" "),a("div",{staticClass:"language-vim extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[s._v("Traceback "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("most recent "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("call")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("last")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  File "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./mysite/wsgi.py"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" line "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("module"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    from django"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("core"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("wsgi import get_wsgi_application\nImportError"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" No module named django"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("core"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("wsgi\nunable "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" load app "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mountpoint"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("callable not found or import error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" no "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("python")]),s._v(" application found"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" check your startup logs "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" errors "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" \n")])])]),a("p",[s._v("阅读启动日志，我们发现，错误原因是"),a("em",[s._v("ImportError: No module named django.core.wsgi")]),s._v("。也就是说，uwsgi并没有正确识别python的包环境，找不到Django。解决方法是在uwsgi9001.ini中添加Django的正确路径。\n终端查询Django所在路径:")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ pip show django "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -i location\nLocation: /usr/local/lib/python2.7/dist-packages \n")])])]),a("p",[s._v("然后在*/python/uwsgi.ini.d/uwsgi9001.ini*的最后一行添加如下内容并保存：")]),s._v(" "),a("div",{staticClass:"language-vim extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[s._v("pythonpath "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("python2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dist"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("packages \n")])])]),a("p",[s._v("再次启动uwsgi进程：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("uwsgi --ini /python/uwsgi.ini.d/uwsgi9001.ini \n")])])]),a("p",[s._v("**注意：**如果端口被占用，可以使用uwsgi配置文件中设置的pidfile来进行停止")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("uwsgi --stop /var/run/uwsgi9001.pid  \n")])])]),a("p",[s._v("或者杀死全部uwsgi进程")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("killall")]),s._v(" -9 uwsgi \n")])])]),a("p",[s._v("然后再次用浏览器访问服务器ip，这次成功显示了和使用runserver相同的Django的It worked!成功提示。至此，用Nginx+uwsgi对Django进行部署的步骤全部完成。")])])},[],!1,null,null,null);t.default=e.exports}}]);