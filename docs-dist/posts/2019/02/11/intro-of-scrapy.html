<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Scrapy入门 | yuchanns&#39;Atelier</title>
    <meta name="description" content="focus on python|php">
    <link rel="icon" href="/yuchanns.png">
  <meta name="google-site-verification" content="h0GK-apopUhINJJe5Jp3XopZswk6EK_JQT_fVMrs6A0">
  <meta name="baidu-site-verification" content="OeVj0fzw4S">
    
    <link rel="preload" href="/assets/css/0.styles.eb8afa4a.css" as="style"><link rel="preload" href="/assets/js/app.f1298f72.js" as="script"><link rel="preload" href="/assets/js/3.cd7d6ac4.js" as="script"><link rel="preload" href="/assets/js/19.88e29e11.js" as="script"><link rel="prefetch" href="/assets/js/1.1516f943.js"><link rel="prefetch" href="/assets/js/10.0d42dcc2.js"><link rel="prefetch" href="/assets/js/11.0f58cf83.js"><link rel="prefetch" href="/assets/js/12.7aabf4e0.js"><link rel="prefetch" href="/assets/js/13.10474817.js"><link rel="prefetch" href="/assets/js/14.d0809dde.js"><link rel="prefetch" href="/assets/js/15.d43c7e25.js"><link rel="prefetch" href="/assets/js/16.9edcbcca.js"><link rel="prefetch" href="/assets/js/17.2e08000f.js"><link rel="prefetch" href="/assets/js/18.a95bab7b.js"><link rel="prefetch" href="/assets/js/20.1376d87e.js"><link rel="prefetch" href="/assets/js/21.0fe3f19e.js"><link rel="prefetch" href="/assets/js/22.3c5a2a49.js"><link rel="prefetch" href="/assets/js/23.3eb72fcb.js"><link rel="prefetch" href="/assets/js/24.a91e9467.js"><link rel="prefetch" href="/assets/js/25.c0a6bc69.js"><link rel="prefetch" href="/assets/js/26.b6899417.js"><link rel="prefetch" href="/assets/js/27.b51f60a4.js"><link rel="prefetch" href="/assets/js/28.792179b8.js"><link rel="prefetch" href="/assets/js/29.2d6289f9.js"><link rel="prefetch" href="/assets/js/4.b7305242.js"><link rel="prefetch" href="/assets/js/5.05b6ad67.js"><link rel="prefetch" href="/assets/js/6.b1a2f38f.js"><link rel="prefetch" href="/assets/js/7.ebfb88b5.js"><link rel="prefetch" href="/assets/js/8.f9ac094a.js"><link rel="prefetch" href="/assets/js/9.52d65113.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eb8afa4a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-meteorlxy"><header class="header" data-v-2db1e33a><div data-v-9292c008 data-v-2db1e33a><nav class="navbar" data-v-9292c008><div class="container" data-v-9292c008><a href="/" class="router-link-active" data-v-9292c008><span class="navbar-site-name" data-v-9292c008>
          yuchanns'Atelier
        </span></a> <div class="navbar-toggler" data-v-9292c008><svg class="icon" style="font-size:1.2em;" data-v-9292c008 data-v-9292c008><title data-v-9292c008 data-v-9292c008>menu</title><use xlink:href="#icon-menu" data-v-9292c008 data-v-9292c008></use></svg></div> <div class="navbar-links" data-v-9292c008><a href="/" class="navbar-link" data-v-9292c008>
            Home
          </a><a href="/posts/" class="navbar-link router-link-active" data-v-9292c008>
            Posts
          </a><a href="/snippets/" class="navbar-link" data-v-9292c008>
            Snippets
          </a><a href="/awesome/" class="navbar-link" data-v-9292c008>
            Awesome
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-9292c008></div></div> <div class="banner" data-v-66d98992 data-v-2db1e33a data-v-2db1e33a><div class="container" data-v-66d98992><div class="center" data-v-66d98992><h1 data-v-66d98992 data-v-2db1e33a>
          Scrapy入门
        </h1></div></div></div></header> <div class="container clearfix show-aside" data-v-226a4f67 data-v-226a4f67><main class="main" data-v-226a4f67><div class="post" data-v-226a4f67 data-v-226a4f67><section class="post-meta main-div" data-v-0afc19fc><section class="post-date clearfix" data-v-0afc19fc><span class="create-date" data-v-0afc19fc>
      发布时间 : 2019-02-11
    </span> <span class="update-date" data-v-0afc19fc>
      最后修改 : Invalid Date
    </span></section> <section class="post-links" data-v-0afc19fc><a href="/posts/2019/02/10/tail-recursion-in-scheme.html" class="post-link" data-v-0afc19fc>
      上一篇 : Scheme学习笔记（一）——尾递归
    </a> <a href="/posts/2019/03/18/vue-in-mvc.html" class="post-link" data-v-0afc19fc>
      下一篇 : vue在传统mvc框架下的使用
    </a></section></section> <article class="main-div"><div class="content default"><p><img src="https://scrapy.org/img/scrapylogo.png" alt="Scrapy"></p> <p><div class="table-of-contents"> <ul><li><a href="/posts/2019/02/11/intro-of-scrapy.html#安装准备">安装准备</a> <!----></li><li><a href="/posts/2019/02/11/intro-of-scrapy.html#创建爬虫项目">创建爬虫项目</a> <!----></li><li><a href="/posts/2019/02/11/intro-of-scrapy.html#最简单的爬取">最简单的爬取</a> <!----></li><li><a href="/posts/2019/02/11/intro-of-scrapy.html#简单处理爬取内容">简单处理爬取内容</a> <!----></li><li><a href="/posts/2019/02/11/intro-of-scrapy.html#使用pipeline组件处理数据">使用Pipeline组件处理数据</a> <!----></li><li><a href="/posts/2019/02/11/intro-of-scrapy.html#总结">总结</a> <!----></li></ul> </div></p> <p>想要掌握python，接触爬虫是一个不可避免的方向。
</p> <p>当然，爬虫并不是python的专利，很多语言都可以实现，但这并不是现在本文要研究的。同样地，不使用框架裸爬也不是本文的目标。</p> <p>python的爬虫框架有很多：Scrapy、PySpider、Crawley、Portia、Newspaper、Beautiful Soup、Grab、Cola等等。</p> <p>本次入门学习爬虫，决定选择Scrapy。</p> <p>参考：<a href="https://docs.scrapy.org/en/latest/" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>python版本：<code>3.7</code>
Scrapy版本：<code>1.6</code></p> <h2 id="安装准备"><a href="#安装准备" aria-hidden="true" class="header-anchor">#</a> 安装准备</h2> <p>使用pip安装即可<code>pip install scrapy</code></p> <p>顺便一提，在本地环境开发学习python的时候，常常会有切换python版本的需要。因此，我通常使用虚拟环境来管理python的版本。我使用版本管理软件是<a href="https://conda.io/en/latest/miniconda.html" target="_blank" rel="noopener noreferrer">Miniconda<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。安装方法不多说（你可以选择bash安装、deb安装、源码编译等多种方式）。简要说明使用方法：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 切换到32位虚拟环境</span>
<span class="token keyword">set</span> CONDA_FORCE_32BIT<span class="token operator">=</span>1

<span class="token comment"># 切换到64位虚拟环境</span>
<span class="token keyword">set</span> CONDA_FORCE_32BIT<span class="token operator">=</span>

<span class="token comment"># 创建新的虚拟环境 &gt; conda create -n 环境名称 python版本</span>
conda create -n py27 python<span class="token operator">=</span>2.7

<span class="token comment"># 激活虚拟环境 &gt; source activate 环境名称</span>
<span class="token function">source</span> activate py27

<span class="token comment"># 退出虚拟环境 &gt; source deactivate</span>
<span class="token function">source</span> deactivate
</code></pre></div><h2 id="创建爬虫项目"><a href="#创建爬虫项目" aria-hidden="true" class="header-anchor">#</a> 创建爬虫项目</h2> <p>和大部分框架一样，首先使用下列命令创建一个新的爬虫项目。本文以<a href="https://www.yuchanns.xyz" target="_blank" rel="noopener noreferrer">我个人博客<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>为爬虫目标：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>scrapy startproject yuchanns
</code></pre></div><p>然后我们得到如下项目结构，注释说明了对应的用途：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token keyword">.</span>
├── scrapy.cfg               <span class="token comment"># scrapy配置文件</span>
└── yuchanns                 <span class="token comment"># 项目模块，放置你的爬虫代码</span>
    ├── __init__.py
    ├── items.py             <span class="token comment"># items定义文件</span>
    ├── middlewares.py       <span class="token comment"># 中间件</span>
    ├── pipelines.py         <span class="token comment"># 管道文件</span>
    ├── settings.py          <span class="token comment"># 项目配置文件</span>
    └── spiders              <span class="token comment"># 爬虫放置目录</span>
        └── __init__.py

</code></pre></div><h2 id="最简单的爬取"><a href="#最简单的爬取" aria-hidden="true" class="header-anchor">#</a> 最简单的爬取</h2> <p>蜘蛛代码就编写在<code>./yuchanns/spiders</code>中。</p> <p>文件名字可以随意取，原则上取我们要爬虫的部分的名称更方便区分。比如我要爬取的是<a href="https://www.yuchanns.xyz/posts/" target="_blank" rel="noopener noreferrer">https://www.yuchanns.xyz/posts/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，所以文件取名为<code>post_spider.py</code>。</p> <p>接着我们书写最简单的爬取代码：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># ./yuchanns/spiders/post_spider.py</span>
<span class="token comment"># @Author yuchanns@www.yuchanns.xyz</span>

<span class="token keyword">import</span> scrapy

<span class="token keyword">class</span> <span class="token class-name">PostSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 类名也可以随意取</span>
    <span class="token comment"># 原则上取我们要爬虫的部分的名称更方便区分</span>
    name <span class="token operator">=</span> <span class="token string">'post'</span>  <span class="token comment"># 蜘蛛的名称，必须是唯一的</span>
    <span class="token comment"># name是Scrapy识别蜘蛛的身份标识</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">(</span>
        <span class="token string">'yuchanns.xyz'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>  <span class="token comment"># 限制爬取的域名范围，超出范围则忽略</span>
    
    <span class="token keyword">def</span> <span class="token function">start_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 当蜘蛛启动时候会调用这个方法</span>
        urls <span class="token operator">=</span> <span class="token punctuation">(</span>
            <span class="token string">'https://www.yuchanns.xyz/posts/'</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>  <span class="token comment"># 指定我们要爬取的地址</span>
        <span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">:</span>
            <span class="token comment"># 使用yield迭代进行爬虫，节省内存</span>
            <span class="token comment"># callback调用回调方法处理数据</span>
            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse<span class="token punctuation">)</span>
            
    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 回调方法，处理数据</span>
        <span class="token comment"># 先简单的将爬去的内容全部装入名为post的文件中</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'post'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> post<span class="token punctuation">:</span>
            post<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span>

</code></pre></div><p><code>scrapy.Spider</code>的子类有三个必须定义的属性：</p> <ul><li><p><code>name</code>：蜘蛛唯一识别身份标识</p></li> <li><p><code>start_requests()</code>：蜘蛛启动所调用的方法</p></li> <li><p><code>parse</code>：回调方法，处理数据用</p></li></ul> <p>在根目录下执行<code>scrapy crawl post</code>，即可进行爬虫。这里的post就是代码中定义的name。</p> <p>然后我们可以发现根目录下生成了一个名为post的文件，打开内容就是我们爬取的页面的所有代码。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- post content --&gt;</span>
<span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>zh-CN<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width,initial-scale=1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Posts | yuchanns<span class="token entity" title="'">&amp;#39;</span>Atelier<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>description<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>focus on python|php<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/yuchanns.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 省略 --&gt;</span>
</code></pre></div><h2 id="简单处理爬取内容"><a href="#简单处理爬取内容" aria-hidden="true" class="header-anchor">#</a> 简单处理爬取内容</h2> <p>成功爬取内容之后，我们要做的就是对数据进行处理，提取。</p> <p>以post为例，我们的目标是提取出此页面的每一篇文章的标题、时间、分类、标签这四个数据。</p> <p>首先我们应该在<code>./yuchanns/items.py</code>定义post页面所需要的数据的结构。定义结构的意义在于方便后面的管道处理数据。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># ./yuchanns/items</span>

<span class="token keyword">import</span> scrapy

<span class="token keyword">class</span> <span class="token class-name">PostItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 名字惯例便于区分</span>
    <span class="token comment"># 定义四个字段类</span>
    title <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    date <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    category <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    tags <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre></div><p>然后对<code>post_spider.py</code>进行修改，对<code>response</code>对象进行<code>xpath</code>处理。</p> <blockquote><p>XPath 使用路径表达式来选取 XML 文档中的节点或节点集。节点是通过沿着路径 (path) 或者步 (steps) 来选取的。</p></blockquote> <p>为了方便，我们可以使用Chrome打开爬取的网页，在DevTools的Elements选项卡中，选中要处理的字段，右键，复制 &gt; 复制XPath，获得XPath：</p> <p><img src="https://i.imgur.com/s3vcPdk.jpg" alt="posts"></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># ./yuchanns/spiders/post_spider.py</span>
<span class="token comment"># @Author yuchanns@www.yuchanns.xyz</span>

<span class="token comment"># &gt;&gt;&gt; 修改：引入PostItem</span>
<span class="token keyword">from</span> yuchanns<span class="token punctuation">.</span>items <span class="token keyword">import</span> PostItem

<span class="token keyword">import</span> scrapy

<span class="token keyword">class</span> <span class="token class-name">PostSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 类名也可以随意取</span>
    <span class="token comment"># 原则上取我们要爬虫的部分的名称更方便区分</span>
    name <span class="token operator">=</span> <span class="token string">'post'</span>  <span class="token comment"># 蜘蛛的名称，必须是唯一的</span>
    <span class="token comment"># name是Scrapy识别蜘蛛的身份标识</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">(</span>
        <span class="token string">'yuchanns.xyz'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>  <span class="token comment"># 限制爬取的域名范围，超出范围则忽略</span>
    
    <span class="token keyword">def</span> <span class="token function">start_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 当蜘蛛启动时候会调用这个方法</span>
        urls <span class="token operator">=</span> <span class="token punctuation">(</span>
            <span class="token string">'https://www.yuchanns.xyz/posts/'</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>  <span class="token comment"># 指定我们要爬取的地址</span>
        <span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">:</span>
            <span class="token comment"># 使用yield迭代进行爬虫，节省内存</span>
            <span class="token comment"># callback调用回调方法处理数据</span>
            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse<span class="token punctuation">)</span>
            
    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 回调方法，处理数据</span>
        <span class="token comment"># 先简单的将爬去的内容全部装入名为post的文件中</span>
        <span class="token comment"># with open('post', 'wb') as post:</span>
        <span class="token comment">#     post.write(response.body)</span>
        <span class="token comment"># &gt;&gt;&gt; 修改：处理获得对应的数据</span>
        items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> each <span class="token keyword">in</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//*[@id=&quot;app&quot;]/div/'</span>
                                   <span class="token string">'main/div/div[2]/div'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 遍历每一个posts-list-item</span>
            item <span class="token operator">=</span> PostItem<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 实例化PostItem对象</span>
            title <span class="token operator">=</span> each<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'a/h3/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>
            date <span class="token operator">=</span> each<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'p[1]/span[1]/span'</span>
                              <span class="token string">'/span/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>
            category <span class="token operator">=</span> each<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'p[1]/span[2]/a/span/'</span>
                                  <span class="token string">'span/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>
            tags <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>tag<span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
                           <span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> tag <span class="token keyword">in</span> each
                           <span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'p[1]/span[3]/span/span/a/text()'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

            item<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span> <span class="token operator">=</span> title<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            item<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> date<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            item<span class="token punctuation">[</span><span class="token string">'category'</span><span class="token punctuation">]</span> <span class="token operator">=</span> category<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            item<span class="token punctuation">[</span><span class="token string">'tags'</span><span class="token punctuation">]</span> <span class="token operator">=</span> tags
            items<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span>
        <span class="token keyword">return</span> items

</code></pre></div><p>再次爬取，我们可以在控制台看到打印出我们处理收集的数据：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'category'</span><span class="token keyword">:</span> <span class="token string">'lisp'</span>,
 <span class="token string">'date'</span><span class="token keyword">:</span> <span class="token string">'2019-02-10'</span>,
 <span class="token string">'tags'</span><span class="token keyword">:</span> <span class="token string">'scheme,尾递归'</span>,
 <span class="token string">'title'</span><span class="token keyword">:</span> <span class="token string">'Scheme学习笔记（一）——尾递归'</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token string">'category'</span><span class="token keyword">:</span> <span class="token string">'lisp'</span>,
 <span class="token string">'date'</span><span class="token keyword">:</span> <span class="token string">'2019-01-15'</span>,
 <span class="token string">'tags'</span><span class="token keyword">:</span> <span class="token string">'scheme'</span>,
 <span class="token string">'title'</span><span class="token keyword">:</span> <span class="token string">'初识Scheme'</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token string">'category'</span><span class="token keyword">:</span> <span class="token string">'学习'</span>,
 <span class="token string">'date'</span><span class="token keyword">:</span> <span class="token string">'2019-01-13'</span>,
 <span class="token string">'tags'</span><span class="token keyword">:</span> <span class="token string">'mysql'</span>,
 <span class="token string">'title'</span><span class="token keyword">:</span> <span class="token string">'MySQL学习笔记01'</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token string">'category'</span><span class="token keyword">:</span> <span class="token string">'TODO'</span>, <span class="token string">'date'</span><span class="token keyword">:</span> <span class="token string">'2019-01-05'</span>, <span class="token string">'tags'</span><span class="token keyword">:</span> <span class="token string">''</span>, <span class="token string">'title'</span><span class="token keyword">:</span> <span class="token string">'2TODOList'</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token string">'category'</span><span class="token keyword">:</span> <span class="token string">'python'</span>,
 <span class="token string">'date'</span><span class="token keyword">:</span> <span class="token string">'2018-12-18'</span>,
 <span class="token string">'tags'</span><span class="token keyword">:</span> <span class="token string">'peewee,tornado'</span>,
 <span class="token string">'title'</span><span class="token keyword">:</span> <span class="token string">'peewee与异步操作'</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token string">'category'</span><span class="token keyword">:</span> <span class="token string">'python'</span>,
 <span class="token string">'date'</span><span class="token keyword">:</span> <span class="token string">'2018-12-12'</span>,
 <span class="token string">'tags'</span><span class="token keyword">:</span> <span class="token string">'peewee,orm'</span>,
 <span class="token string">'title'</span><span class="token keyword">:</span> <span class="token string">'peewee用法考察'</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token string">'category'</span><span class="token keyword">:</span> <span class="token string">'python'</span>,
 <span class="token string">'date'</span><span class="token keyword">:</span> <span class="token string">'2018-11-18'</span>,
 <span class="token string">'tags'</span><span class="token keyword">:</span> <span class="token string">'PyQt5'</span>,
 <span class="token string">'title'</span><span class="token keyword">:</span> <span class="token string">'PyQt5中使用Qprinter打印热敏小票'</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token string">'category'</span><span class="token keyword">:</span> <span class="token string">'python'</span>,
 <span class="token string">'date'</span><span class="token keyword">:</span> <span class="token string">'2018-11-10'</span>,
 <span class="token string">'tags'</span><span class="token keyword">:</span> <span class="token string">'PyQt5'</span>,
 <span class="token string">'title'</span><span class="token keyword">:</span> <span class="token string">'PyQt5中使用QWebChannel和内嵌网页进行js交互'</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token string">'category'</span><span class="token keyword">:</span> <span class="token string">'php'</span>,
 <span class="token string">'date'</span><span class="token keyword">:</span> <span class="token string">'2018-10-09'</span>,
 <span class="token string">'tags'</span><span class="token keyword">:</span> <span class="token string">'swoole,延时任务'</span>,
 <span class="token string">'title'</span><span class="token keyword">:</span> <span class="token string">'php延时任务'</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token string">'category'</span><span class="token keyword">:</span> <span class="token string">'php'</span>,
 <span class="token string">'date'</span><span class="token keyword">:</span> <span class="token string">'2018-08-28'</span>,
 <span class="token string">'tags'</span><span class="token keyword">:</span> <span class="token string">'linux,lnmp,nginx'</span>,
 <span class="token string">'title'</span><span class="token keyword">:</span> <span class="token string">'搭建LNMP环境'</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token string">'category'</span><span class="token keyword">:</span> <span class="token string">'python'</span>,
 <span class="token string">'date'</span><span class="token keyword">:</span> <span class="token string">'2018-08-25'</span>,
 <span class="token string">'tags'</span><span class="token keyword">:</span> <span class="token string">'nginx,uwsgi,django'</span>,
 <span class="token string">'title'</span><span class="token keyword">:</span> <span class="token string">'用Nginx+uwsgi部署Django'</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token string">'category'</span><span class="token keyword">:</span> <span class="token string">'python'</span>,
 <span class="token string">'date'</span><span class="token keyword">:</span> <span class="token string">'2018-08-23'</span>,
 <span class="token string">'tags'</span><span class="token keyword">:</span> <span class="token string">'django'</span>,
 <span class="token string">'title'</span><span class="token keyword">:</span> <span class="token string">'Django二级域名配置'</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><h2 id="使用pipeline组件处理数据"><a href="#使用pipeline组件处理数据" aria-hidden="true" class="header-anchor">#</a> 使用Pipeline组件处理数据</h2> <p>通常，在<code>parse</code>方法的最后我们会将items返回，这样items就会被交到<code>Item Pipeline</code>中。然后我们就可以在piplines中进行进一步的加工处理，例如录入数据库等。</p> <p>我们在<code>./yuchanns/pipelines.py</code>中书写组件代码，同时不要忘记将组件<strong>注册</strong>到<code>./yuchanns/settings.py</code>的<code>ITEM_PIPELINES</code>中！</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># ./yuchanns/settings.py</span>
<span class="token comment"># 注册管道组件</span>

<span class="token comment"># Configure item pipelines</span>
<span class="token comment"># See https://doc.scrapy.org/en/latest/topics/item-pipeline.html</span>
ITEM_PIPELINES <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token string">'yuchanns.piplines.PostPipline'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>  <span class="token comment"># 包含管道组件和执行顺序的字典，顺序范围0~1000</span>
</code></pre></div><p>管道组件必须包含下面这个方法：</p> <ul><li><code>process_item(self, item, spider)</code>：当item通过每个管道组件时都会调用，不作任何处理的情况下我们应该返回<code>item</code>或者返回一个<code>Twisted Deferred</code>，传递给下一个管道组件</li></ul> <p>管道组件还提供以下几个方法：</p> <ul><li><code>open_spider(self, spider)</code>：当蜘蛛被打开时调用</li> <li><code>close_spider(self, spider)</code>：当蜘蛛被关闭时调用</li></ul> <p>在本例中，我们使用pymysql将数据录入到mysql中。</p> <p>首先给出post表的数据结构：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>posts<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>title<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'文章标题'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span><span class="token keyword">date</span><span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'发布时间'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>category<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'文章分类'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>tags<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'文章分类'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'Posts爬虫数据收集'</span>
</code></pre></div><p>然后书写<code>./yuchanns/pipelines.py</code>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># ./yuchanns/pipelines.py</span>
<span class="token comment"># @Author yuchanns@www.yuchanns.xyz</span>

<span class="token keyword">import</span> pymysql

<span class="token keyword">class</span> <span class="token class-name">PostPipeline</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    db <span class="token operator">=</span> <span class="token boolean">None</span>
    cursor <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 注意这里是每个item调用一次</span>
        data <span class="token operator">=</span> <span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> item<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                item<span class="token punctuation">[</span><span class="token string">'category'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> item<span class="token punctuation">[</span><span class="token string">'tags'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>
            <span class="token string">&quot;insert into `posts`(`title`, `date`, `category`&quot;</span>
            <span class="token string">&quot;, `tags`) values (%s, %s, %s, %s)&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> item

    <span class="token keyword">def</span> <span class="token function">open_spider</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 创建数据库连接</span>
        self<span class="token punctuation">.</span>db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;scrapy&quot;</span><span class="token punctuation">)</span>
        <span class="token comment"># 获得游标对象</span>
        self<span class="token punctuation">.</span>cursor <span class="token operator">=</span> self<span class="token punctuation">.</span>db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">close_spider</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 关闭数据库连接</span>
        self<span class="token punctuation">.</span>db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre></div><p>查看mysql，可以知道数据确实已经存入mysql</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">use</span> scrapy
<span class="token keyword">Database</span> changed
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> posts<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+--------------------------------------------------------+---------------------+----------+---------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> title                                                  <span class="token operator">|</span> <span class="token keyword">date</span>                <span class="token operator">|</span> category <span class="token operator">|</span> tags                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------------------------------------------------------+---------------------+----------+---------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> Scheme学习笔记（一）——尾递归                           <span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span> lisp     <span class="token operator">|</span> scheme<span class="token punctuation">,</span>尾递归       <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> 初识Scheme                                             <span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span> lisp     <span class="token operator">|</span> scheme              <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> MySQL学习笔记<span class="token number">01</span>                                        <span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">13</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span> 学习     <span class="token operator">|</span> mysql               <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span>TODOList                                          <span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span> TODO     <span class="token operator">|</span>                     <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> peewee与异步操作                                       <span class="token operator">|</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">18</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span> python   <span class="token operator">|</span> peewee<span class="token punctuation">,</span>tornado      <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span> peewee用法考察                                         <span class="token operator">|</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span> python   <span class="token operator">|</span> peewee<span class="token punctuation">,</span>orm          <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7</span> <span class="token operator">|</span> PyQt5中使用Qprinter打印热敏小票                        <span class="token operator">|</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">18</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span> python   <span class="token operator">|</span> PyQt5               <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">8</span> <span class="token operator">|</span> PyQt5中使用QWebChannel和内嵌网页进行js交互             <span class="token operator">|</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span> python   <span class="token operator">|</span> PyQt5               <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">9</span> <span class="token operator">|</span> php延时任务                                            <span class="token operator">|</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">09</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span> php      <span class="token operator">|</span> swoole<span class="token punctuation">,</span>延时任务     <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">10</span> <span class="token operator">|</span> 搭建LNMP环境                                           <span class="token operator">|</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span> php      <span class="token operator">|</span> linux<span class="token punctuation">,</span>lnmp<span class="token punctuation">,</span>nginx    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">11</span> <span class="token operator">|</span> 用Nginx<span class="token operator">+</span>uwsgi部署Django                                <span class="token operator">|</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span> python   <span class="token operator">|</span> nginx<span class="token punctuation">,</span>uwsgi<span class="token punctuation">,</span>django  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">12</span> <span class="token operator">|</span> Django二级域名配置                                     <span class="token operator">|</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span> python   <span class="token operator">|</span> django              <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------------------------------------------------------+---------------------+----------+---------------------+</span>
<span class="token number">12</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>当然，实际使用时，出于这样或那样的原因（比如逐条插入数据效率低下之类的），我们通常不会这样将数据直接存入数据库。</p> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>现在，我们对Scrapy的使用有一个大概的认知。</p> <p>首先，使用<code>scrapy startproject projectname</code>创建一个爬虫项目。</p> <p>然后，在<code>./projectname/spiders</code>文件夹下编写蜘蛛代码，每个蜘蛛的<code>name</code>都是独一无二的。</p> <p>接着，在编写过程中，我们使用<code>XPath</code>语法获取需要的数据，并用<code>./projectname/items.py</code>定义结构类接收数据，然后传入Item Pipelines。</p> <p>最后，在<code>./projectname/pipelines.py</code>中编写管道组件，对数据进行处理，并注册到<code>./projectname/settings.py</code>的<code>ITEM_PIPELINES</code>。</p></div></article> <section class="post-meta main-div" data-v-0afc19fc><section class="post-date clearfix" data-v-0afc19fc><span class="create-date" data-v-0afc19fc>
      发布时间 : 2019-02-11
    </span> <span class="update-date" data-v-0afc19fc>
      最后修改 : Invalid Date
    </span></section> <section class="post-links" data-v-0afc19fc><a href="/posts/2019/02/10/tail-recursion-in-scheme.html" class="post-link" data-v-0afc19fc>
      上一篇 : Scheme学习笔记（一）——尾递归
    </a> <a href="/posts/2019/03/18/vue-in-mvc.html" class="post-link" data-v-0afc19fc>
      下一篇 : vue在传统mvc框架下的使用
    </a></section></section> <div id="post-comments" class="main-div"><!----></div></div></main> <aside class="aside" data-v-226a4f67><div class="info-card main-div" data-v-acfd4c20 data-v-226a4f67><div class="info-card-header" data-v-acfd4c20><img src="https://avatars3.githubusercontent.com/u/25029451" alt="yuchanns" class="info-avatar" data-v-acfd4c20></div> <div class="info-card-body" data-v-acfd4c20><section class="info-nickname" data-v-acfd4c20>
      yuchanns
    </section> <section class="info-desc" data-v-acfd4c20>A non professional programmer which attempt to be professional</section> <section class="info-contact" data-v-acfd4c20><section data-v-acfd4c20><span title="Shenzhen, China" data-v-acfd4c20 data-v-acfd4c20><svg class="icon" style="font-size:1em;" data-v-acfd4c20 data-v-acfd4c20><title data-v-acfd4c20 data-v-acfd4c20>Shenzhen, China</title><use xlink:href="#icon-location" data-v-acfd4c20 data-v-acfd4c20></use></svg><span class="info-text" data-v-acfd4c20 data-v-acfd4c20>
          Shenzhen, China
        </span></span></section> <!----> <section data-v-acfd4c20><a href="mailto:airamusume@gmail.com" title="airamusume@gmail.com" data-v-acfd4c20 data-v-acfd4c20><svg class="icon" style="font-size:1em;" data-v-acfd4c20 data-v-acfd4c20><title data-v-acfd4c20 data-v-acfd4c20>airamusume@gmail.com</title><use xlink:href="#icon-email" data-v-acfd4c20 data-v-acfd4c20></use></svg><span class="info-text" data-v-acfd4c20 data-v-acfd4c20>
          airamusume@gmail.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-acfd4c20><section class="info-sns clearfix" data-v-acfd4c20><a href="https://github.com/yuchanns" target="_blank" class="sns-link" data-v-acfd4c20><span title="GitHub: yuchanns" class="sns-icon" data-v-acfd4c20 data-v-acfd4c20><svg class="icon" style="font-size:1.5em;" data-v-acfd4c20 data-v-acfd4c20><title data-v-acfd4c20 data-v-acfd4c20>GitHub: yuchanns</title><use xlink:href="#icon-github" data-v-acfd4c20 data-v-acfd4c20></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-226a4f67><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span></span> <div class="post-nav-toc"> <ul><li><a href="/posts/2019/02/11/intro-of-scrapy.html#安装准备">安装准备</a> <!----></li><li><a href="/posts/2019/02/11/intro-of-scrapy.html#创建爬虫项目">创建爬虫项目</a> <!----></li><li><a href="/posts/2019/02/11/intro-of-scrapy.html#最简单的爬取">最简单的爬取</a> <!----></li><li><a href="/posts/2019/02/11/intro-of-scrapy.html#简单处理爬取内容">简单处理爬取内容</a> <!----></li><li><a href="/posts/2019/02/11/intro-of-scrapy.html#使用pipeline组件处理数据">使用Pipeline组件处理数据</a> <!----></li><li><a href="/posts/2019/02/11/intro-of-scrapy.html#总结">总结</a> <!----></li></ul> </div></div> <div class="post-nav-comments"><svg class="icon"><title>comment</title><use xlink:href="#icon-comment"></use></svg> <a href="/posts/2019/02/11/intro-of-scrapy.html#post-comments">
      
    </a></div></div></aside></div> <footer class="footer" data-v-a7ec77da><p class="sns-links" data-v-a7ec77da><a href="https://github.com/yuchanns" target="_blank" class="sns-link" data-v-a7ec77da><span title="GitHub: yuchanns" class="sns-icon" data-v-a7ec77da data-v-a7ec77da><svg class="icon" style="font-size:25px;" data-v-a7ec77da data-v-a7ec77da><title data-v-a7ec77da data-v-a7ec77da>GitHub: yuchanns</title><use xlink:href="#icon-github" data-v-a7ec77da data-v-a7ec77da></use></svg></span></a></p> <p data-v-a7ec77da><span data-v-a7ec77da>Powered by </span> <a href="https://vuepress.vuejs.org" target="_blank" data-v-a7ec77da>
      Vuepress
    </a></p> <span id="busuanzi_container_site_pv" data-v-a7ec77da>你是第<span id="busuanzi_value_site_pv" data-v-a7ec77da></span>位访问者</span> <p data-v-a7ec77da><a href="http://beian.miit.gov.cn/" target="_blank" style="color: #666" data-v-a7ec77da>
        闽ICP备19005068号
    </a></p></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.f1298f72.js" defer></script><script src="/assets/js/3.cd7d6ac4.js" defer></script><script src="/assets/js/19.88e29e11.js" defer></script>
  </body>
</html>
