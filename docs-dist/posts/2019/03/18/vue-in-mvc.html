<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue在传统mvc框架下的使用 | yuchanns&#39;Atelier</title>
    <meta name="description" content="focus on python|php">
    <link rel="icon" href="/yuchanns.png">
  <meta name="google-site-verification" content="h0GK-apopUhINJJe5Jp3XopZswk6EK_JQT_fVMrs6A0">
  <meta name="baidu-site-verification" content="OeVj0fzw4S">
    
    <link rel="preload" href="/assets/css/0.styles.eb8afa4a.css" as="style"><link rel="preload" href="/assets/js/app.f1298f72.js" as="script"><link rel="preload" href="/assets/js/3.cd7d6ac4.js" as="script"><link rel="preload" href="/assets/js/26.b6899417.js" as="script"><link rel="prefetch" href="/assets/js/1.1516f943.js"><link rel="prefetch" href="/assets/js/10.0d42dcc2.js"><link rel="prefetch" href="/assets/js/11.0f58cf83.js"><link rel="prefetch" href="/assets/js/12.7aabf4e0.js"><link rel="prefetch" href="/assets/js/13.10474817.js"><link rel="prefetch" href="/assets/js/14.d0809dde.js"><link rel="prefetch" href="/assets/js/15.d43c7e25.js"><link rel="prefetch" href="/assets/js/16.9edcbcca.js"><link rel="prefetch" href="/assets/js/17.2e08000f.js"><link rel="prefetch" href="/assets/js/18.a95bab7b.js"><link rel="prefetch" href="/assets/js/19.88e29e11.js"><link rel="prefetch" href="/assets/js/20.1376d87e.js"><link rel="prefetch" href="/assets/js/21.0fe3f19e.js"><link rel="prefetch" href="/assets/js/22.3c5a2a49.js"><link rel="prefetch" href="/assets/js/23.3eb72fcb.js"><link rel="prefetch" href="/assets/js/24.a91e9467.js"><link rel="prefetch" href="/assets/js/25.c0a6bc69.js"><link rel="prefetch" href="/assets/js/27.b51f60a4.js"><link rel="prefetch" href="/assets/js/28.792179b8.js"><link rel="prefetch" href="/assets/js/29.2d6289f9.js"><link rel="prefetch" href="/assets/js/4.b7305242.js"><link rel="prefetch" href="/assets/js/5.05b6ad67.js"><link rel="prefetch" href="/assets/js/6.b1a2f38f.js"><link rel="prefetch" href="/assets/js/7.ebfb88b5.js"><link rel="prefetch" href="/assets/js/8.f9ac094a.js"><link rel="prefetch" href="/assets/js/9.52d65113.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eb8afa4a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-meteorlxy"><header class="header" data-v-2db1e33a><div data-v-9292c008 data-v-2db1e33a><nav class="navbar" data-v-9292c008><div class="container" data-v-9292c008><a href="/" class="router-link-active" data-v-9292c008><span class="navbar-site-name" data-v-9292c008>
          yuchanns'Atelier
        </span></a> <div class="navbar-toggler" data-v-9292c008><svg class="icon" style="font-size:1.2em;" data-v-9292c008 data-v-9292c008><title data-v-9292c008 data-v-9292c008>menu</title><use xlink:href="#icon-menu" data-v-9292c008 data-v-9292c008></use></svg></div> <div class="navbar-links" data-v-9292c008><a href="/" class="navbar-link" data-v-9292c008>
            Home
          </a><a href="/posts/" class="navbar-link router-link-active" data-v-9292c008>
            Posts
          </a><a href="/snippets/" class="navbar-link" data-v-9292c008>
            Snippets
          </a><a href="/awesome/" class="navbar-link" data-v-9292c008>
            Awesome
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-9292c008></div></div> <div class="banner" data-v-66d98992 data-v-2db1e33a data-v-2db1e33a><div class="container" data-v-66d98992><div class="center" data-v-66d98992><h1 data-v-66d98992 data-v-2db1e33a>
          vue在传统mvc框架下的使用
        </h1></div></div></div></header> <div class="container clearfix show-aside" data-v-226a4f67 data-v-226a4f67><main class="main" data-v-226a4f67><div class="post" data-v-226a4f67 data-v-226a4f67><section class="post-meta main-div" data-v-0afc19fc><section class="post-date clearfix" data-v-0afc19fc><span class="create-date" data-v-0afc19fc>
      发布时间 : 2019-03-18
    </span> <span class="update-date" data-v-0afc19fc>
      最后修改 : Invalid Date
    </span></section> <section class="post-links" data-v-0afc19fc><a href="/posts/2019/02/11/intro-of-scrapy.html" class="post-link" data-v-0afc19fc>
      上一篇 : Scrapy入门
    </a> <!----></section></section> <article class="main-div"><div class="content default"><p><div class="table-of-contents"> <ul><li><a href="/posts/2019/03/18/vue-in-mvc.html#准备工作">准备工作</a> <ul><li><a href="/posts/2019/03/18/vue-in-mvc.html#安装环境">安装环境</a> <!----></li><li><a href="/posts/2019/03/18/vue-in-mvc.html#framework结构">framework结构</a> <!----></li></ul></li><li><a href="/posts/2019/03/18/vue-in-mvc.html#模板继承和vue组件">模板继承和vue组件</a> <ul><li><a href="/posts/2019/03/18/vue-in-mvc.html#文件变动">文件变动</a> <!----></li><li><a href="/posts/2019/03/18/vue-in-mvc.html#代码变动">代码变动</a> <!----></li><li><a href="/posts/2019/03/18/vue-in-mvc.html#这样写有什么好处-？">这样写有什么好处 ？</a> <!----></li></ul></li><li><a href="/posts/2019/03/18/vue-in-mvc.html#对组件命名重复的解决方案">对组件命名重复的解决方案</a> <ul><li><a href="/posts/2019/03/18/vue-in-mvc.html#文件变动-2">文件变动</a> <!----></li><li><a href="/posts/2019/03/18/vue-in-mvc.html#代码变动-2">代码变动</a> <!----></li><li><a href="/posts/2019/03/18/vue-in-mvc.html#为什么要使用组件？">为什么要使用组件？</a> <!----></li></ul></li><li><a href="/posts/2019/03/18/vue-in-mvc.html#总结">总结</a> <!----></li><li><a href="/posts/2019/03/18/vue-in-mvc.html#本文源代码">本文源代码</a> <!----></li></ul> </div></p> <p>当我们手上有前后端不分离的传统mvc框架下的项目，又想要摆脱繁琐的Dom操作地狱，就可以使用<a href="https://cn.vuejs.org" target="_blank" rel="noopener noreferrer">vuejs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。在github上我看到很多前后端不分离的项目源码中对于<code>vuejs</code>的整合都是直接在项目根目录放置一个frontend文件夹，内置<code>vue-cli</code>生成的开发脚手架，在<code>webpack</code>下以<code>es6</code>语法的形式编写，再将编译生成的<code>dist</code>页面放到后端mvc的view中。</p> <p>有时候（当编写小项目的时候）我觉得这样也显得过于复杂和巨大，幸好<code>vuejs</code>支持直接用<code>&lt;script&gt;</code>引入使用。本文记录的便是我在这种背景下，利用模板引擎的特性对<code>vuejs</code>的使用心得。</p> <h2 id="准备工作"><a href="#准备工作" aria-hidden="true" class="header-anchor">#</a> 准备工作</h2> <p>本文所使用的web框架基于<code>python3.7</code>，使用到的库包括：</p> <ul><li>aiohttp</li> <li>aiohttp-jinja2</li> <li>uvloop</li></ul> <p>你也可以随便选择一个web框架，无论是<code>django</code>或者<code>flask</code>或者<code>tornado</code>，甚至是<code>php</code>也没问题，只需要模板引擎支持<code>模板继承</code>以及<code>导入上下文</code>的功能就行。本文只是出于搭设便捷的目的做出选择。</p> <h3 id="安装环境"><a href="#安装环境" aria-hidden="true" class="header-anchor">#</a> 安装环境</h3> <p>使用<code>miniconda3</code>创建一个虚拟环境并安装库：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>conda create -n aiohttp python<span class="token operator">=</span>3.7
<span class="token function">source</span> activate aiohttp
<span class="token punctuation">(</span>aiohttp<span class="token punctuation">)</span> pip <span class="token function">install</span> aiohttp aiohttp-jinja2 uvloop
</code></pre></div><p>当然<code>aiohttp-jinja2</code>还依赖于<code>jinja2</code>这个库，不过这些关联依赖都会由pip自行解决，用户不必关心细节。</p> <h3 id="framework结构"><a href="#framework结构" aria-hidden="true" class="header-anchor">#</a> framework结构</h3> <p>这里仅使用典型性而简洁的mvc框架结构：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token keyword">.</span>
├── handlers
│   ├── __init__.py
│   └── index.py
├── main.py
└── templates
    └── base
        └── base.html
</code></pre></div><p>下面给出各文件源码：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># main.py</span>

<span class="token keyword">import</span> uvloop
<span class="token keyword">from</span> aiohttp_jinja2 <span class="token keyword">import</span> setup
<span class="token keyword">from</span> jinja2 <span class="token keyword">import</span> FileSystemLoader
<span class="token keyword">from</span> aiohttp <span class="token keyword">import</span> web
<span class="token keyword">from</span> handlers<span class="token punctuation">.</span>index <span class="token keyword">import</span> routes


<span class="token keyword">def</span> <span class="token function">make_app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    app <span class="token operator">=</span> web<span class="token punctuation">.</span>Application<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 注意！为了避免vue和jinja2的Mustache语法冲突</span>
    <span class="token comment"># 我将jinja2的模板变量改成{$variable}的形式 </span>
    setup<span class="token punctuation">(</span>app<span class="token punctuation">,</span> loader<span class="token operator">=</span>FileSystemLoader<span class="token punctuation">(</span><span class="token string">'./templates'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          variable_start_string<span class="token operator">=</span><span class="token string">'{$'</span><span class="token punctuation">,</span> variable_end_string<span class="token operator">=</span><span class="token string">'}'</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>add_routes<span class="token punctuation">(</span>routes<span class="token punctuation">)</span>
    <span class="token keyword">return</span> app

<span class="token keyword">try</span><span class="token punctuation">:</span>
    uvloop<span class="token punctuation">.</span>install<span class="token punctuation">(</span><span class="token punctuation">)</span>
    web<span class="token punctuation">.</span>run_app<span class="token punctuation">(</span>make_app<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">9000</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> KeyboardInterrupt<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'see you!'</span><span class="token punctuation">)</span>

</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># handlers/index.py</span>

<span class="token keyword">from</span> aiohttp_jinja2 <span class="token keyword">import</span> template
<span class="token keyword">from</span> aiohttp <span class="token keyword">import</span> web


routes <span class="token operator">=</span> web<span class="token punctuation">.</span>RouteTableDef<span class="token punctuation">(</span><span class="token punctuation">)</span>


@routes<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
@template<span class="token punctuation">(</span><span class="token string">'base/base.html'</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span>

</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- templates/base/base.html --&gt;</span>

<span class="token doctype">&lt;!DOCTYPE&gt;
&lt;html&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>aiohttp-vue<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ greeting }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/vue@2.6.9/dist/vue.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
      <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span>
            greeting<span class="token punctuation">:</span> <span class="token string">'hello world'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>启动aiohttp服务器，访问 http://127.0.0.1:9000/ 可正常见到<code>hello world</code></p> <h2 id="模板继承和vue组件"><a href="#模板继承和vue组件" aria-hidden="true" class="header-anchor">#</a> 模板继承和vue组件</h2> <p>在前端框架下我们编写代码通常是以组件的形式：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ greeting }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      greeting<span class="token punctuation">:</span> <span class="token string">'hello world'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在<code>jinja2</code>模板中，我们可以使用<code>{% block title %}{% endblock %}</code>这一模板继承功能达到相似写法。</p> <h3 id="文件变动"><a href="#文件变动" aria-hidden="true" class="header-anchor">#</a> 文件变动</h3> <p>首先在templates文件夹下创建一个index文件夹，在该文件夹下创建一个index.html文件。然后我们将index.py中，<code>@template('base/base.html')</code>改成<code>@template('index/index.html')</code></p> <h3 id="代码变动"><a href="#代码变动" aria-hidden="true" class="header-anchor">#</a> 代码变动</h3> <p>然后修改templates/base/base.html，加入组件（<a href="https://cn.vuejs.org/v2/guide/components.html" target="_blank" rel="noopener noreferrer">对组件不了解？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token deleted">&lt;!-- templates/base/base.html --&gt;</span>

<span class="token deleted">&lt;!DOCTYPE&gt;</span>
<span class="token deleted">&lt;html&gt;</span>
  &lt;head&gt;
    &lt;title&gt;aiohttp-vue&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;app&quot;&gt;
<span class="token deleted">-     &lt;p&gt;{{ greeting }}&lt;/p&gt;</span>
<span class="token inserted">+     &lt;main-content&gt;&lt;/main-content&gt;</span>
    &lt;/div&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue@2.6.9/dist/vue.js&quot;&gt;
    &lt;/script&gt;
<span class="token inserted">+   {% block script %}</span>
<span class="token inserted">+   &lt;script&gt;</span>
<span class="token inserted">+     let mainContent = {}</span>
<span class="token inserted">+   &lt;/script&gt;</span>
<span class="token inserted">+   {% endblock %}</span>
    &lt;script&gt;
<span class="token inserted">+     mainContent.template = `&lt;div&gt;{% block template %}{% endblock %}&lt;/div&gt;`</span>
<span class="token inserted">+     Vue.component('main-content', mainContent)</span>
<span class="token deleted">-     const app = new Vue({</span>
<span class="token inserted">+     const app = new Vue().$mount('#app')</span>
<span class="token deleted">-       data () {</span>
<span class="token deleted">-         return {</span>
<span class="token deleted">-           greeting: 'hello world'</span>
<span class="token deleted">-         }</span>
<span class="token deleted">-       }</span>
<span class="token deleted">-     }).$mount('#app')</span>
    &lt;/script&gt;
  &lt;/body&gt;
<span class="token deleted">&lt;/html&gt;</span>
</code></pre></div><p>接着编写templates/index/index.html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- templates/index/index.html --&gt;</span>

{% extends &quot;base/base.html&quot; %}

{% block template %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ greeting }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
{% endblock %}

{% block script %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">let</span> mainContent <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      greeting<span class="token punctuation">:</span> <span class="token string">'hello world'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
{% endblock %}
</code></pre></div><p>重新启动aiohttp服务器，再次访问同一网址，可以得到不变的结果。</p> <h3 id="这样写有什么好处-？"><a href="#这样写有什么好处-？" aria-hidden="true" class="header-anchor">#</a> 这样写有什么好处 ？</h3> <p>由于我们嫌弃在前后不分离的小项目中使用纯前端框架过于复杂和巨大而选择导入script，所以我们也使用不到vuejs的单文件组件服，转而使用字符串模板定义组件。这样做的缺点是：html模板缺乏<strong>语法高亮</strong>，以及另外几个<a href="https://cn.vuejs.org/v2/guide/single-file-components.html#%E4%BB%8B%E7%BB%8D" target="_blank" rel="noopener noreferrer">缺点<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>当我们像上述方式利用模板引擎的模板继承功能，就获得了<strong>完整语法高亮</strong>。</p> <p>并且我们也可以在<code>Vue DevTools</code>完全观察到整个html页面的组件结构。</p> <p><img src="https://i.imgur.com/vegX2ny.jpg" alt="Vue DevTools"></p> <p>只需要写一次base.html，任何继承base模块的模板都将自动成为其组件，而我们只需要放心地在模块里享受语法高亮的服务，写自己的业务代码。</p> <p>遗憾的是我们依旧面临着<strong>全局作用域的CSS</strong>（即使你在<code>style</code>标签里添加<code>scoped</code>的属性，也只有<code>firefox</code>支持）、<strong>每个component中的命名不得重复</strong>的问题。</p> <p>当然，我们在开头就说过，之所以采用script引入而不使用前端框架编译开发的原因是目标项目小而简单，因此全局css和组件命名不得重复并不是什么太大的问题。</p> <h2 id="对组件命名重复的解决方案"><a href="#对组件命名重复的解决方案" aria-hidden="true" class="header-anchor">#</a> 对组件命名重复的解决方案</h2> <p>接下来这部分是针对模板引擎带有<strong>宏定义</strong>功能的组件命名重复解决方式。</p> <p>结合<code>jinja2</code>的<code>macro</code>功能和上下文引入可以如此使用。如果是php用户，可以使用twig模板引擎，和jinja2类似。</p> <h3 id="文件变动-2"><a href="#文件变动-2" aria-hidden="true" class="header-anchor">#</a> 文件变动</h3> <p>首先在templates/index文件夹下创建一个components文件夹，然后在该文件夹下面创建一个test.html文件。</p> <h3 id="代码变动-2"><a href="#代码变动-2" aria-hidden="true" class="header-anchor">#</a> 代码变动</h3> <p>我们编写一个名为<code>test</code>的组件：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- templates/index/components/test.html --&gt;</span>

{% macro template() -%}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
{%- endmacro %}

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
    <span class="token keyword">const</span> test <span class="token operator">=</span> <span class="token comment">// {% macro script() -%}</span>
    <span class="token punctuation">{</span>
        <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                title<span class="token punctuation">:</span> <span class="token string">'test'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        template<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`{$ template() }`</span></span>
    <span class="token punctuation">}</span>
    <span class="token comment">// {%- endmacro %}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>对index.html做出如下修改：</p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token deleted">&lt;!-- templates/index/index.html --&gt;</span>

{% extends &quot;base/base.html&quot; %}

{% block template %}
<span class="token deleted">&lt;p&gt;{{ greeting }}&lt;/p&gt;</span>
<span class="token inserted">+ &lt;test&gt;&lt;/test&gt;</span>
{% endblock %}

{% block script %}
<span class="token inserted">+ {% from 'index/components/test.html' import script %}</span>
<span class="token deleted">&lt;script&gt;</span>
  let mainContent = {
<span class="token inserted">+   components: {},</span>
    data () {
      return {
        greeting: 'hello world'
      }
    }
  }
<span class="token inserted">+ mainContent.components.test = {$script()}</span>
<span class="token deleted">&lt;/script&gt;</span>
{% endblock %}
</code></pre></div><p>再次访问网址，可以看到新添加的组件生效了。</p> <p>此时 我们在templates/index/components文件夹下再创建一个test2.html文件，内容则和test.html一模一样。
然后对index.html进行修改：</p> <div class="language-diff extra-class"><pre class="language-diff"><code>{% extends &quot;base/base.html&quot; %}

{% block template %}
<span class="token deleted">&lt;p&gt;{{ greeting }}&lt;/p&gt;</span>
<span class="token deleted">&lt;test&gt;&lt;/test&gt;</span>
<span class="token inserted">+ &lt;test2&gt;&lt;/test2&gt;</span>
{% endblock %}

{% block script %}
{% from 'index/components/test.html' import script %}
<span class="token inserted">+ {% from 'index/components/test2.html' import script as script2 %}</span>
<span class="token deleted">&lt;script&gt;</span>
  let mainContent = {
    components: {},
    data () {
      return {
        greeting: 'hello world'
      }
    }
  }
  mainContent.components.test = {$script()}
<span class="token inserted">+ mainContent.components.test2 = {$script2()}</span>
<span class="token deleted">&lt;/script&gt;</span>
{% endblock %}
</code></pre></div><p>访问网址，确认正常。</p> <h3 id="为什么要使用组件？"><a href="#为什么要使用组件？" aria-hidden="true" class="header-anchor">#</a> 为什么要使用组件？</h3> <p>事实上，我最开始这样做的时候，采用的是<code>Vue.extend(mainContent)</code>的形式。但是<code>Vuejs</code>的组件的一个好优势就是组件内的一切只在组件当中起作用，我们就不用担心各种名字重复的问题。</p> <p>上述所说对组件命名重复的解决方案，实际上是通过<code>宏</code>功能为组件命名来规避名字重复（如同引用单文件组件的<code>import test as test2 from './components/test'</code>）。解决的方法并不是特别方便（编写过程有感知），幸好写起来并不麻烦。</p> <p>是否使用此方法以解决组件名称重复？无论哪种选择，只要在编写代码的过程中注意相应的问题，我们就可以畅快地在前后端不分离的传统mvc项目中使用<code>vuejs</code>了！</p> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>文中我提到了两种组件的写法，一种<strong>模块继承</strong>，一种<strong>宏定义</strong>。我建议两种写法结合使用。</p> <p><strong>模块继承</strong>用于继承布局之后书写主体业务代码使用，和常规的模板继承写法一致，实际渲染起来则是作为<code>Vue</code>的文章组件;<strong>宏定义</strong>则作为在文章组件中使用组件的解决方案。当然，并不是说没有宏定义就不能在组件中使用组件了，只不过这样你将失去html代码高亮功能，转而只能书写丑陋的字符串模板，未免令人有些不满～</p> <h2 id="本文源代码"><a href="#本文源代码" aria-hidden="true" class="header-anchor">#</a> 本文源代码</h2> <p>https://github.com/yuchanns/vue-in-mvc</p></div></article> <section class="post-meta main-div" data-v-0afc19fc><section class="post-date clearfix" data-v-0afc19fc><span class="create-date" data-v-0afc19fc>
      发布时间 : 2019-03-18
    </span> <span class="update-date" data-v-0afc19fc>
      最后修改 : Invalid Date
    </span></section> <section class="post-links" data-v-0afc19fc><a href="/posts/2019/02/11/intro-of-scrapy.html" class="post-link" data-v-0afc19fc>
      上一篇 : Scrapy入门
    </a> <!----></section></section> <div id="post-comments" class="main-div"><!----></div></div></main> <aside class="aside" data-v-226a4f67><div class="info-card main-div" data-v-acfd4c20 data-v-226a4f67><div class="info-card-header" data-v-acfd4c20><img src="https://avatars3.githubusercontent.com/u/25029451" alt="yuchanns" class="info-avatar" data-v-acfd4c20></div> <div class="info-card-body" data-v-acfd4c20><section class="info-nickname" data-v-acfd4c20>
      yuchanns
    </section> <section class="info-desc" data-v-acfd4c20>A non professional programmer which attempt to be professional</section> <section class="info-contact" data-v-acfd4c20><section data-v-acfd4c20><span title="Shenzhen, China" data-v-acfd4c20 data-v-acfd4c20><svg class="icon" style="font-size:1em;" data-v-acfd4c20 data-v-acfd4c20><title data-v-acfd4c20 data-v-acfd4c20>Shenzhen, China</title><use xlink:href="#icon-location" data-v-acfd4c20 data-v-acfd4c20></use></svg><span class="info-text" data-v-acfd4c20 data-v-acfd4c20>
          Shenzhen, China
        </span></span></section> <!----> <section data-v-acfd4c20><a href="mailto:airamusume@gmail.com" title="airamusume@gmail.com" data-v-acfd4c20 data-v-acfd4c20><svg class="icon" style="font-size:1em;" data-v-acfd4c20 data-v-acfd4c20><title data-v-acfd4c20 data-v-acfd4c20>airamusume@gmail.com</title><use xlink:href="#icon-email" data-v-acfd4c20 data-v-acfd4c20></use></svg><span class="info-text" data-v-acfd4c20 data-v-acfd4c20>
          airamusume@gmail.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-acfd4c20><section class="info-sns clearfix" data-v-acfd4c20><a href="https://github.com/yuchanns" target="_blank" class="sns-link" data-v-acfd4c20><span title="GitHub: yuchanns" class="sns-icon" data-v-acfd4c20 data-v-acfd4c20><svg class="icon" style="font-size:1.5em;" data-v-acfd4c20 data-v-acfd4c20><title data-v-acfd4c20 data-v-acfd4c20>GitHub: yuchanns</title><use xlink:href="#icon-github" data-v-acfd4c20 data-v-acfd4c20></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-226a4f67><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span></span> <div class="post-nav-toc"> <ul><li><a href="/posts/2019/03/18/vue-in-mvc.html#准备工作">准备工作</a> <ul><li><a href="/posts/2019/03/18/vue-in-mvc.html#安装环境">安装环境</a> <!----></li><li><a href="/posts/2019/03/18/vue-in-mvc.html#framework结构">framework结构</a> <!----></li></ul></li><li><a href="/posts/2019/03/18/vue-in-mvc.html#模板继承和vue组件">模板继承和vue组件</a> <ul><li><a href="/posts/2019/03/18/vue-in-mvc.html#文件变动">文件变动</a> <!----></li><li><a href="/posts/2019/03/18/vue-in-mvc.html#代码变动">代码变动</a> <!----></li><li><a href="/posts/2019/03/18/vue-in-mvc.html#这样写有什么好处-？">这样写有什么好处 ？</a> <!----></li></ul></li><li><a href="/posts/2019/03/18/vue-in-mvc.html#对组件命名重复的解决方案">对组件命名重复的解决方案</a> <ul><li><a href="/posts/2019/03/18/vue-in-mvc.html#文件变动-2">文件变动</a> <!----></li><li><a href="/posts/2019/03/18/vue-in-mvc.html#代码变动-2">代码变动</a> <!----></li><li><a href="/posts/2019/03/18/vue-in-mvc.html#为什么要使用组件？">为什么要使用组件？</a> <!----></li></ul></li><li><a href="/posts/2019/03/18/vue-in-mvc.html#总结">总结</a> <!----></li><li><a href="/posts/2019/03/18/vue-in-mvc.html#本文源代码">本文源代码</a> <!----></li></ul> </div></div> <div class="post-nav-comments"><svg class="icon"><title>comment</title><use xlink:href="#icon-comment"></use></svg> <a href="/posts/2019/03/18/vue-in-mvc.html#post-comments">
      
    </a></div></div></aside></div> <footer class="footer" data-v-a7ec77da><p class="sns-links" data-v-a7ec77da><a href="https://github.com/yuchanns" target="_blank" class="sns-link" data-v-a7ec77da><span title="GitHub: yuchanns" class="sns-icon" data-v-a7ec77da data-v-a7ec77da><svg class="icon" style="font-size:25px;" data-v-a7ec77da data-v-a7ec77da><title data-v-a7ec77da data-v-a7ec77da>GitHub: yuchanns</title><use xlink:href="#icon-github" data-v-a7ec77da data-v-a7ec77da></use></svg></span></a></p> <p data-v-a7ec77da><span data-v-a7ec77da>Powered by </span> <a href="https://vuepress.vuejs.org" target="_blank" data-v-a7ec77da>
      Vuepress
    </a></p> <span id="busuanzi_container_site_pv" data-v-a7ec77da>你是第<span id="busuanzi_value_site_pv" data-v-a7ec77da></span>位访问者</span> <p data-v-a7ec77da><a href="http://beian.miit.gov.cn/" target="_blank" style="color: #666" data-v-a7ec77da>
        闽ICP备19005068号
    </a></p></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.f1298f72.js" defer></script><script src="/assets/js/3.cd7d6ac4.js" defer></script><script src="/assets/js/26.b6899417.js" defer></script>
  </body>
</html>
