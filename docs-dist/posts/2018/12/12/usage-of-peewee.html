<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>peewee用法考察 | yuchanns&#39;Atelier</title>
    <meta name="description" content="focus on python|php">
    <link rel="icon" href="/yuchanns.png">
  <meta name="google-site-verification" content="h0GK-apopUhINJJe5Jp3XopZswk6EK_JQT_fVMrs6A0">
  <meta name="baidu-site-verification" content="OeVj0fzw4S">
    
    <link rel="preload" href="/assets/css/0.styles.eb8afa4a.css" as="style"><link rel="preload" href="/assets/js/app.f1298f72.js" as="script"><link rel="preload" href="/assets/js/3.cd7d6ac4.js" as="script"><link rel="preload" href="/assets/js/25.c0a6bc69.js" as="script"><link rel="prefetch" href="/assets/js/1.1516f943.js"><link rel="prefetch" href="/assets/js/10.0d42dcc2.js"><link rel="prefetch" href="/assets/js/11.0f58cf83.js"><link rel="prefetch" href="/assets/js/12.7aabf4e0.js"><link rel="prefetch" href="/assets/js/13.10474817.js"><link rel="prefetch" href="/assets/js/14.d0809dde.js"><link rel="prefetch" href="/assets/js/15.d43c7e25.js"><link rel="prefetch" href="/assets/js/16.9edcbcca.js"><link rel="prefetch" href="/assets/js/17.2e08000f.js"><link rel="prefetch" href="/assets/js/18.a95bab7b.js"><link rel="prefetch" href="/assets/js/19.88e29e11.js"><link rel="prefetch" href="/assets/js/20.1376d87e.js"><link rel="prefetch" href="/assets/js/21.0fe3f19e.js"><link rel="prefetch" href="/assets/js/22.3c5a2a49.js"><link rel="prefetch" href="/assets/js/23.3eb72fcb.js"><link rel="prefetch" href="/assets/js/24.a91e9467.js"><link rel="prefetch" href="/assets/js/26.b6899417.js"><link rel="prefetch" href="/assets/js/27.b51f60a4.js"><link rel="prefetch" href="/assets/js/28.792179b8.js"><link rel="prefetch" href="/assets/js/29.2d6289f9.js"><link rel="prefetch" href="/assets/js/4.b7305242.js"><link rel="prefetch" href="/assets/js/5.05b6ad67.js"><link rel="prefetch" href="/assets/js/6.b1a2f38f.js"><link rel="prefetch" href="/assets/js/7.ebfb88b5.js"><link rel="prefetch" href="/assets/js/8.f9ac094a.js"><link rel="prefetch" href="/assets/js/9.52d65113.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eb8afa4a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-meteorlxy"><header class="header" data-v-2db1e33a><div data-v-9292c008 data-v-2db1e33a><nav class="navbar" data-v-9292c008><div class="container" data-v-9292c008><a href="/" class="router-link-active" data-v-9292c008><span class="navbar-site-name" data-v-9292c008>
          yuchanns'Atelier
        </span></a> <div class="navbar-toggler" data-v-9292c008><svg class="icon" style="font-size:1.2em;" data-v-9292c008 data-v-9292c008><title data-v-9292c008 data-v-9292c008>menu</title><use xlink:href="#icon-menu" data-v-9292c008 data-v-9292c008></use></svg></div> <div class="navbar-links" data-v-9292c008><a href="/" class="navbar-link" data-v-9292c008>
            Home
          </a><a href="/posts/" class="navbar-link router-link-active" data-v-9292c008>
            Posts
          </a><a href="/snippets/" class="navbar-link" data-v-9292c008>
            Snippets
          </a><a href="/awesome/" class="navbar-link" data-v-9292c008>
            Awesome
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-9292c008></div></div> <div class="banner" data-v-66d98992 data-v-2db1e33a data-v-2db1e33a><div class="container" data-v-66d98992><div class="center" data-v-66d98992><h1 data-v-66d98992 data-v-2db1e33a>
          peewee用法考察
        </h1></div></div></div></header> <div class="container clearfix show-aside" data-v-226a4f67 data-v-226a4f67><main class="main" data-v-226a4f67><div class="post" data-v-226a4f67 data-v-226a4f67><section class="post-meta main-div" data-v-0afc19fc><section class="post-date clearfix" data-v-0afc19fc><span class="create-date" data-v-0afc19fc>
      发布时间 : 2018-12-12
    </span> <span class="update-date" data-v-0afc19fc>
      最后修改 : Invalid Date
    </span></section> <section class="post-links" data-v-0afc19fc><a href="/posts/2018/11/18/thermal-print-with-qprinter.html" class="post-link" data-v-0afc19fc>
      上一篇 : PyQt5中使用Qprinter打印热敏小票
    </a> <a href="/posts/2018/12/18/peewee-with-async.html" class="post-link" data-v-0afc19fc>
      下一篇 : peewee与异步操作
    </a></section></section> <article class="main-div"><div class="content default"><p><div class="table-of-contents"> <ul><li><a href="/posts/2018/12/12/usage-of-peewee.html#考察目标">考察目标</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#前置准备">前置准备</a> <ul><li><a href="/posts/2018/12/12/usage-of-peewee.html#在mysql中新建表">在mysql中新建表</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#生成映射模型">生成映射模型</a> <!----></li></ul></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#create">Create</a> <ul><li><a href="/posts/2018/12/12/usage-of-peewee.html#第一种添加方法">第一种添加方法</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#第二种添加方法">第二种添加方法</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#第三种添加方法">第三种添加方法</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#批量添加方法">批量添加方法</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#批量块添加方法">批量块添加方法</a> <!----></li></ul></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#retrieve-1">Retrieve(1)</a> <ul><li><a href="/posts/2018/12/12/usage-of-peewee.html#读取单条数据">读取单条数据</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#读取多条数据">读取多条数据</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#查询表达式">查询表达式</a> <!----></li></ul></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#update">Update</a> <ul><li><a href="/posts/2018/12/12/usage-of-peewee.html#第一种更新方法">第一种更新方法</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#第二种更新方法">第二种更新方法</a> <!----></li></ul></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#transaction">Transaction</a> <ul><li><a href="/posts/2018/12/12/usage-of-peewee.html#开启事务的方法">开启事务的方法</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#应用情景">应用情景</a> <!----></li></ul></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#retrieve-2">Retrieve(2)</a> <ul><li><a href="/posts/2018/12/12/usage-of-peewee.html#join">join</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#union-all">union[ all]</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#聚合查询">聚合查询</a> <!----></li></ul></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#delete">Delete</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#原生sql支持">原生sql支持</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#总结">总结</a> <!----></li></ul> </div></p> <p>最近尝试使用tornado。由于tornado组件较为简洁，还需引入一些其他类库结合使用。在ORM方面，我选择了轻量小巧的peewee。本文即对peewee的用法进行初步考察，记录自用。
主要参考内容：
<a href="http://docs.peewee-orm.com/en/latest/" target="_blank" rel="noopener noreferrer">peewee官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="考察目标"><a href="#考察目标" aria-hidden="true" class="header-anchor">#</a> 考察目标</h2> <p>peewee支持多种数据库，而本文的考察环境是mysql，存储引擎为InnoDB。
常用的sql操作可简单分为CURD。我平常工作使用的功能细分如下：</p> <ul><li>Create：单条插入、批量插入、批量块插入、获取自增pk</li> <li>Update：数据更新</li> <li>Retrieve：单条查询、多条查询、指定字段单条/多条查询、关联查询（join、union）、聚合查询</li> <li>Delete：单条删除、批量删除</li> <li>其他功能：事务、原生sql查询</li></ul> <h2 id="前置准备"><a href="#前置准备" aria-hidden="true" class="header-anchor">#</a> 前置准备</h2> <h3 id="在mysql中新建表"><a href="#在mysql中新建表" aria-hidden="true" class="header-anchor">#</a> 在mysql中新建表</h3> <p>本文使用数据库名为peewee，三张表分别是user、balance和integral，结构如下：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>uid<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户编号'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>avartar<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'头像'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>uname<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户名'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gender<span class="token punctuation">`</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'性别 0-保密|1-男|2-女'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>password<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'密码'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>balance<span class="token punctuation">`</span> <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0.00'</span> <span class="token keyword">COMMENT</span> <span class="token string">'余额'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>integral<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'积分'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>logintime<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'最后登录时间'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>addtime<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'注册时间'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>uid<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>uname<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>uname<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户名唯一'</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">10000</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'用户信息'</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>balance<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>b_id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'操作编号'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>uid<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户编号'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>change<span class="token punctuation">`</span> <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0.00'</span> <span class="token keyword">COMMENT</span> <span class="token string">'变动金额'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>total<span class="token punctuation">`</span> <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0.00'</span> <span class="token keyword">COMMENT</span> <span class="token string">'剩余金额'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>addtime<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'操作时间'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>b_id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>uid<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>uid<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户编号'</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'余额操作记录表'</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>integral<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>i_id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'操作编号'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>uid<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户编号'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>change<span class="token punctuation">`</span> <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0.00'</span> <span class="token keyword">COMMENT</span> <span class="token string">'变动积分'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>total<span class="token punctuation">`</span> <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0.00'</span> <span class="token keyword">COMMENT</span> <span class="token string">'剩余积分'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>addtime<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'操作时间'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>i_id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>uid<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>uid<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户编号'</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'积分操作记录表'</span>
</code></pre></div><p>python连接mysql，需要pymysql或mysql-connector-python。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> pymysql peewee
</code></pre></div><h3 id="生成映射模型"><a href="#生成映射模型" aria-hidden="true" class="header-anchor">#</a> 生成映射模型</h3> <p>peewee分别提供<strong>根据模型生成表</strong>和<strong>根据表生成模型</strong>的功能。但peewee等orm要考虑兼容多种数据库，因此模型生成表的过程中只能使用所有数据库公有的字段类型，不能使用mysql的tinyint、char等类型，所以不考虑根据模型生成表。使用<a href="http://docs.peewee-orm.com/en/latest/peewee/playhouse.html#pwiz" target="_blank" rel="noopener noreferrer">pwiz<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>命令生成模型：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>python -m pwiz -e mysql -H localhost -p3306 -uroot -P peewee <span class="token operator">&gt;</span> models.py
</code></pre></div><p>获得以下model文件：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># models.py</span>

<span class="token keyword">from</span> peewee <span class="token keyword">import</span> <span class="token operator">*</span>

database <span class="token operator">=</span> MySQLDatabase<span class="token punctuation">(</span><span class="token string">'peewee'</span><span class="token punctuation">,</span> <span class="token operator">**</span><span class="token punctuation">{</span><span class="token string">'charset'</span><span class="token punctuation">:</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token string">'use_unicode'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">'host'</span><span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span> <span class="token string">'port'</span><span class="token punctuation">:</span> <span class="token number">3306</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">UnknownField</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>_<span class="token punctuation">,</span> <span class="token operator">**</span>__<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">pass</span>


<span class="token keyword">class</span> <span class="token class-name">BaseModel</span><span class="token punctuation">(</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        database <span class="token operator">=</span> database


<span class="token keyword">class</span> <span class="token class-name">Balance</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    addtime <span class="token operator">=</span> DateTimeField<span class="token punctuation">(</span>constraints<span class="token operator">=</span><span class="token punctuation">[</span>SQL<span class="token punctuation">(</span><span class="token string">&quot;DEFAULT CURRENT_TIMESTAMP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    b <span class="token operator">=</span> AutoField<span class="token punctuation">(</span>column_name<span class="token operator">=</span><span class="token string">'b_id'</span><span class="token punctuation">)</span>
    change <span class="token operator">=</span> DecimalField<span class="token punctuation">(</span>constraints<span class="token operator">=</span><span class="token punctuation">[</span>SQL<span class="token punctuation">(</span><span class="token string">&quot;DEFAULT 0.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    total <span class="token operator">=</span> DecimalField<span class="token punctuation">(</span>constraints<span class="token operator">=</span><span class="token punctuation">[</span>SQL<span class="token punctuation">(</span><span class="token string">&quot;DEFAULT 0.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    uid <span class="token operator">=</span> IntegerField<span class="token punctuation">(</span>constraints<span class="token operator">=</span><span class="token punctuation">[</span>SQL<span class="token punctuation">(</span><span class="token string">&quot;DEFAULT 0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        table_name <span class="token operator">=</span> <span class="token string">'balance'</span>


<span class="token keyword">class</span> <span class="token class-name">Integral</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    addtime <span class="token operator">=</span> DateTimeField<span class="token punctuation">(</span>constraints<span class="token operator">=</span><span class="token punctuation">[</span>SQL<span class="token punctuation">(</span><span class="token string">&quot;DEFAULT CURRENT_TIMESTAMP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    change <span class="token operator">=</span> DecimalField<span class="token punctuation">(</span>constraints<span class="token operator">=</span><span class="token punctuation">[</span>SQL<span class="token punctuation">(</span><span class="token string">&quot;DEFAULT 0.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    i <span class="token operator">=</span> AutoField<span class="token punctuation">(</span>column_name<span class="token operator">=</span><span class="token string">'i_id'</span><span class="token punctuation">)</span>
    total <span class="token operator">=</span> DecimalField<span class="token punctuation">(</span>constraints<span class="token operator">=</span><span class="token punctuation">[</span>SQL<span class="token punctuation">(</span><span class="token string">&quot;DEFAULT 0.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    uid <span class="token operator">=</span> IntegerField<span class="token punctuation">(</span>constraints<span class="token operator">=</span><span class="token punctuation">[</span>SQL<span class="token punctuation">(</span><span class="token string">&quot;DEFAULT 0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        table_name <span class="token operator">=</span> <span class="token string">'integral'</span>


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    addtime <span class="token operator">=</span> DateTimeField<span class="token punctuation">(</span>constraints<span class="token operator">=</span><span class="token punctuation">[</span>SQL<span class="token punctuation">(</span><span class="token string">&quot;DEFAULT CURRENT_TIMESTAMP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    avartar <span class="token operator">=</span> CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    balance <span class="token operator">=</span> DecimalField<span class="token punctuation">(</span>constraints<span class="token operator">=</span><span class="token punctuation">[</span>SQL<span class="token punctuation">(</span><span class="token string">&quot;DEFAULT 0.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    gender <span class="token operator">=</span> CharField<span class="token punctuation">(</span>constraints<span class="token operator">=</span><span class="token punctuation">[</span>SQL<span class="token punctuation">(</span><span class="token string">&quot;DEFAULT '0'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    integral <span class="token operator">=</span> IntegerField<span class="token punctuation">(</span>constraints<span class="token operator">=</span><span class="token punctuation">[</span>SQL<span class="token punctuation">(</span><span class="token string">&quot;DEFAULT 0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    logintime <span class="token operator">=</span> DateTimeField<span class="token punctuation">(</span>constraints<span class="token operator">=</span><span class="token punctuation">[</span>SQL<span class="token punctuation">(</span><span class="token string">&quot;DEFAULT CURRENT_TIMESTAMP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    password <span class="token operator">=</span> CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    uid <span class="token operator">=</span> AutoField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    uname <span class="token operator">=</span> CharField<span class="token punctuation">(</span>unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        table_name <span class="token operator">=</span> <span class="token string">'user'</span>
</code></pre></div><h2 id="create"><a href="#create" aria-hidden="true" class="header-anchor">#</a> Create</h2> <p>新建一个peewee_test.py文件，引入models，使用logging类库观察执行的sql语句。</p> <h3 id="第一种添加方法"><a href="#第一种添加方法" aria-hidden="true" class="header-anchor">#</a> 第一种添加方法</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># peewee_test.py</span>

<span class="token keyword">from</span> models <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> sys<span class="token punctuation">,</span> logging<span class="token punctuation">,</span> hashlib

<span class="token comment"># 使用日志观察执行的sql语句</span>
logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">'peewee'</span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>StreamHandler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;md5加密密码&quot;&quot;&quot;</span>
    m <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span>
    m<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    pwd <span class="token operator">=</span> m<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;头像&quot;&quot;&quot;</span>
    avartar <span class="token operator">=</span> <span class="token string">'https://avatars2.githubusercontent.com/u/25029451'</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;第一种添加方法&quot;&quot;&quot;</span>
    user <span class="token operator">=</span> User<span class="token punctuation">(</span>
        avartar<span class="token operator">=</span>avartar<span class="token punctuation">,</span> 
        uname<span class="token operator">=</span><span class="token string">'John'</span><span class="token punctuation">,</span> gender<span class="token operator">=</span><span class="token string">'1'</span><span class="token punctuation">,</span> password<span class="token operator">=</span>pwd
    <span class="token punctuation">)</span>
    uid <span class="token operator">=</span> user<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'uid=%d'</span> <span class="token operator">%</span> uid<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>create<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>运行peewee_test.py，查看控制台输出信息，我们得知第一种添加方法不会返回插入的自增pk（此时自增pk为uid=10000），而是成功返回1，失败返回0；</p> <div class="language-shell extra-class"><pre class="language-shell"><code>python peewee_test.py
<span class="token punctuation">(</span><span class="token string">'INSERT INTO <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> (<span class="token variable"><span class="token variable">`</span>avartar<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>gender<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>password<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span><span class="token function">uname</span><span class="token variable">`</span></span>) VALUES (%s, %s, %s, %s)'</span>, <span class="token punctuation">[</span><span class="token string">'https://avatars2.githubusercontent.com/u/25029451'</span>, <span class="token string">'1'</span>, <span class="token string">'e10adc3949ba59abbe56e057f20f883e'</span>, <span class="token string">'John'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
uid<span class="token operator">=</span>1

Process finished with <span class="token keyword">exit</span> code 0
</code></pre></div><h3 id="第二种添加方法"><a href="#第二种添加方法" aria-hidden="true" class="header-anchor">#</a> 第二种添加方法</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;第二种添加方法&quot;&quot;&quot;</span>
    uid <span class="token operator">=</span> User<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
        avartar<span class="token operator">=</span>avartar<span class="token punctuation">,</span>
        uname<span class="token operator">=</span><span class="token string">'Jack'</span><span class="token punctuation">,</span> gender<span class="token operator">=</span><span class="token string">'1'</span><span class="token punctuation">,</span> password<span class="token operator">=</span>pwd
    <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'uid=%s'</span> <span class="token operator">%</span> uid<span class="token punctuation">)</span>
</code></pre></div><p><strong>注意</strong>第二种方法中我打印uid使用格式化操作符是%s而不是%d，因为返回值是一个User对象
查看控制台输出信息，可知第二种方法会返回自增pk；</p> <div class="language-shell extra-class"><pre class="language-shell"><code>python peewee_test.py
<span class="token punctuation">(</span><span class="token string">'INSERT INTO <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> (<span class="token variable"><span class="token variable">`</span>avartar<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>gender<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>password<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span><span class="token function">uname</span><span class="token variable">`</span></span>) VALUES (%s, %s, %s, %s)'</span>, <span class="token punctuation">[</span><span class="token string">'https://avatars2.githubusercontent.com/u/25029451'</span>, <span class="token string">'1'</span>, <span class="token string">'e10adc3949ba59abbe56e057f20f883e'</span>, <span class="token string">'Jack'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
uid<span class="token operator">=</span>10001

Process finished with <span class="token keyword">exit</span> code 0
</code></pre></div><h3 id="第三种添加方法"><a href="#第三种添加方法" aria-hidden="true" class="header-anchor">#</a> 第三种添加方法</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;第三种添加方法&quot;&quot;&quot;</span>
    uid <span class="token operator">=</span> User<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>
        avartar<span class="token operator">=</span>avartar<span class="token punctuation">,</span>
        uname<span class="token operator">=</span><span class="token string">'Micheal'</span><span class="token punctuation">,</span> gender<span class="token operator">=</span><span class="token string">'1'</span><span class="token punctuation">,</span> password<span class="token operator">=</span>pwd
    <span class="token punctuation">)</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'uid=%d'</span> <span class="token operator">%</span> uid<span class="token punctuation">)</span>
</code></pre></div><p>查看控制台输出信息，第三种方法也会返回自增pk。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>python peewee_test.py
<span class="token punctuation">(</span><span class="token string">'INSERT INTO <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> (<span class="token variable"><span class="token variable">`</span>avartar<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>gender<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>password<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span><span class="token function">uname</span><span class="token variable">`</span></span>) VALUES (%s, %s, %s, %s)'</span>, <span class="token punctuation">[</span><span class="token string">'https://avatars2.githubusercontent.com/u/25029451'</span>, <span class="token string">'1'</span>, <span class="token string">'e10adc3949ba59abbe56e057f20f883e'</span>, <span class="token string">'Micheal'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
uid<span class="token operator">=</span>10002

Process finished with <span class="token keyword">exit</span> code 0
</code></pre></div><p>**第一种需要调用save()方法才能插入数据，而第二种不需要调用其他方法，第三种则调用execute()方法进行插入。**第二种方法返回的是对象，第三种方法返回的是整型。工作中我经常需要在后续代码中使用到自增pk，因此我将采用insert()方法进行添加操作。</p> <h3 id="批量添加方法"><a href="#批量添加方法" aria-hidden="true" class="header-anchor">#</a> 批量添加方法</h3> <p>使用insert_many批量添加数据：在插入多条数据时，根据<a href="http://docs.peewee-orm.com/en/latest/peewee/querying.html#bulk-inserts" target="_blank" rel="noopener noreferrer">文档描述<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，create()方法每次都会开启事务（如果存储引擎支持），虽然可以遍历方式用上述方法逐条插入，但数据量一大就会导致效率低下，所以有必要进行批量插入优化。</p> <blockquote><p>If you are not wrapping the loop in a transaction then each call to create() happens in its own transaction. That is going to be really slow!</p></blockquote> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;批量添加数据&quot;&quot;&quot;</span>
    data_source <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">(</span>avartar<span class="token punctuation">,</span> <span class="token string">'Catherine'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> pwd<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>avartar<span class="token punctuation">,</span> <span class="token string">'Jane'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> pwd<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>avartar <span class="token string">'Mary'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> pwd<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    field <span class="token operator">=</span> <span class="token punctuation">[</span>User<span class="token punctuation">.</span>avartar<span class="token punctuation">,</span> User<span class="token punctuation">.</span>uname<span class="token punctuation">,</span> User<span class="token punctuation">.</span>gender<span class="token punctuation">,</span> User<span class="token punctuation">.</span>password<span class="token punctuation">]</span>
    uid <span class="token operator">=</span> User<span class="token punctuation">.</span>insert_many<span class="token punctuation">(</span>data_source<span class="token punctuation">,</span> field<span class="token punctuation">)</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'uid=%d'</span> <span class="token operator">%</span> uid<span class="token punctuation">)</span>
</code></pre></div><p>控制台输出返回批量插入过程中第一条数据的自增pk；</p> <div class="language-shell extra-class"><pre class="language-shell"><code>python peewee_test.py
<span class="token punctuation">(</span><span class="token string">'INSERT INTO <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> (<span class="token variable"><span class="token variable">`</span>avartar<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span><span class="token function">uname</span><span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>gender<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>password<span class="token variable">`</span></span>) VALUES (%s, %s, %s, %s), (%s, %s, %s, %s), (%s, %s, %s, %s)'</span>, <span class="token punctuation">[</span><span class="token string">'https://avatars2.githubusercontent.com/u/25029451'</span>, <span class="token string">'Catherine'</span>, <span class="token string">'2'</span>, <span class="token string">'e10adc3949ba59abbe56e057f20f883e'</span>, <span class="token string">'https://avatars2.githubusercontent.com/u/25029451'</span>, <span class="token string">'Jane'</span>, <span class="token string">'2'</span>, <span class="token string">'e10adc3949ba59abbe56e057f20f883e'</span>, <span class="token string">'https://avatars2.githubusercontent.com/u/25029451'</span>, <span class="token string">'Mary'</span>, <span class="token string">'2'</span>, <span class="token string">'e10adc3949ba59abbe56e057f20f883e'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
uid<span class="token operator">=</span>10003

Process finished with <span class="token keyword">exit</span> code 0
</code></pre></div><h3 id="批量块添加方法"><a href="#批量块添加方法" aria-hidden="true" class="header-anchor">#</a> 批量块添加方法</h3> <p>如果要插入的数据量非常大，比如有千万条。一次性批量插入将会导致卡死，逐条插入也会导致耗时过长。此时可以折中寻求一个分批次批量插入的方案：使用peewee的chunked(it, n)方法将数据分割成小块数据（比如每次1000条，chunked(data_source, 1000)）分批次批量插入：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;批量块添加数据&quot;&quot;&quot;</span>
    data_source <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">(</span>avartar<span class="token punctuation">,</span> <span class="token string">'Zoe'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> pwd<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>avartar<span class="token punctuation">,</span> <span class="token string">'Lucy'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> pwd<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>avartar<span class="token punctuation">,</span> <span class="token string">'Kara'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> pwd<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>avartar<span class="token punctuation">,</span> <span class="token string">'Rex'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> pwd<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    field <span class="token operator">=</span> <span class="token punctuation">[</span>User<span class="token punctuation">.</span>avartar<span class="token punctuation">,</span> User<span class="token punctuation">.</span>uname<span class="token punctuation">,</span> User<span class="token punctuation">.</span>gender<span class="token punctuation">,</span> User<span class="token punctuation">.</span>password<span class="token punctuation">]</span>
    <span class="token keyword">for</span> data_chunk <span class="token keyword">in</span> chunked<span class="token punctuation">(</span>data_source<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        User<span class="token punctuation">.</span>insert_many<span class="token punctuation">(</span>data_chunk<span class="token punctuation">,</span> field<span class="token punctuation">)</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>控制台输出的信息表明了chunked的实质：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>python peewee_test.py
<span class="token punctuation">(</span><span class="token string">'INSERT INTO <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> (<span class="token variable"><span class="token variable">`</span>avartar<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span><span class="token function">uname</span><span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>gender<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>password<span class="token variable">`</span></span>) VALUES (%s, %s, %s, %s), (%s, %s, %s, %s)'</span>, <span class="token punctuation">[</span><span class="token string">'https://avatars2.githubusercontent.com/u/25029451'</span>, <span class="token string">'Zoe'</span>, <span class="token string">'2'</span>, <span class="token string">'e10adc3949ba59abbe56e057f20f883e'</span>, <span class="token string">'https://avatars2.githubusercontent.com/u/25029451'</span>, <span class="token string">'Lucy'</span>, <span class="token string">'2'</span>, <span class="token string">'e10adc3949ba59abbe56e057f20f883e'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'INSERT INTO <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> (<span class="token variable"><span class="token variable">`</span>avartar<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span><span class="token function">uname</span><span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>gender<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>password<span class="token variable">`</span></span>) VALUES (%s, %s, %s, %s), (%s, %s, %s, %s)'</span>, <span class="token punctuation">[</span><span class="token string">'https://avatars2.githubusercontent.com/u/25029451'</span>, <span class="token string">'Kara'</span>, <span class="token string">'2'</span>, <span class="token string">'e10adc3949ba59abbe56e057f20f883e'</span>, <span class="token string">'https://avatars2.githubusercontent.com/u/25029451'</span>, <span class="token string">'Rex'</span>, <span class="token string">'1'</span>, <span class="token string">'e10adc3949ba59abbe56e057f20f883e'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

Process finished with <span class="token keyword">exit</span> code 0
</code></pre></div><h2 id="retrieve-1"><a href="#retrieve-1" aria-hidden="true" class="header-anchor">#</a> Retrieve(1)</h2> <h3 id="读取单条数据"><a href="#读取单条数据" aria-hidden="true" class="header-anchor">#</a> 读取单条数据</h3> <p>直接调用get()方法，可以添加过滤(filter)条件。查询结果是一个User对象，直接打印得到pk，通过调用成员变量可以获得对应字段的值。特别的，当筛选条件为pk时，可以使用get_by_id()方法直接查询：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;读取一条数据&quot;&quot;&quot;</span>
    <span class="token comment"># result = User.get_by_id(10000)</span>
    result <span class="token operator">=</span> User<span class="token punctuation">.</span>get<span class="token punctuation">(</span>User<span class="token punctuation">.</span>uname <span class="token operator">==</span> <span class="token string">'Jack'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'直接打印：%s'</span> <span class="token operator">%</span> result<span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;查看结构&quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'%s:%s'</span> <span class="token operator">%</span> item <span class="token keyword">for</span> item <span class="token keyword">in</span> result<span class="token punctuation">.</span>__data__<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'用户名为：%s'</span> <span class="token operator">%</span> result<span class="token punctuation">.</span>uname<span class="token punctuation">)</span>
</code></pre></div><p>控制台输出：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>python peewee_test.py
<span class="token punctuation">(</span><span class="token string">'SELECT <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>uid<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>addtime<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>avartar<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>balance<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>gender<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>integral<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>logintime<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>password<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span><span class="token variable">`</span></span> FROM <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> AS <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span> WHERE (<span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span><span class="token variable">`</span></span> = %s) LIMIT %s OFFSET %s'</span>, <span class="token punctuation">[</span><span class="token string">'Jack'</span>, 1, 0<span class="token punctuation">]</span><span class="token punctuation">)</span>
直接打印：10001
uid:10001
addtime:2018-12-12 10:22:53
avartar:https://avatars2.githubusercontent.com/u/25029451
balance:0.00
gender:1
integral:0
logintime:2018-12-12 10:22:53
password:e10adc3949ba59abbe56e057f20f883e
uname:Jack
用户名为：Jack

Process finished with <span class="token keyword">exit</span> code 0
</code></pre></div><p>使用get()方法查询出来的数据包含了所有的字段。那么，当我们的需求是<strong>查询单条数据中的限定字段(fields)<strong>时，应该怎么查询呢？阅读get()方法的源码可以得知，其调用了select()方法返回的</strong>ModelSelect类</strong>中的get()方法：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># peewee.py</span>
@<span class="token builtin">classmethod</span>
<span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">*</span>query<span class="token punctuation">,</span> <span class="token operator">**</span>filters<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sq <span class="token operator">=</span> cls<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> query<span class="token punctuation">:</span>
        sq <span class="token operator">=</span> sq<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token operator">*</span>query<span class="token punctuation">)</span>
    <span class="token keyword">if</span> filters<span class="token punctuation">:</span>
        sq <span class="token operator">=</span> sq<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token operator">**</span>filters<span class="token punctuation">)</span>
    <span class="token keyword">return</span> sq<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>因此，我们可以直接调用select()方法，然后调用get()方法，就可以实现需求。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;查询一条数据中的限定字段(uname)&quot;&quot;&quot;</span>
    result <span class="token operator">=</span> User<span class="token punctuation">.</span>select<span class="token punctuation">(</span>User<span class="token punctuation">.</span>uname<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>User<span class="token punctuation">.</span>uid <span class="token operator">==</span> <span class="token number">10001</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;查看结构&quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'%s:%s'</span> <span class="token operator">%</span> item <span class="token keyword">for</span> item <span class="token keyword">in</span> result<span class="token punctuation">.</span>__data__<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>事实上，很多时候工作中遇到的单一查询都是只需要其中几个字段的数据，因此比起get()我用的更多的将会是select().get()。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>python peewee_test.py
<span class="token punctuation">(</span><span class="token string">'SELECT <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span><span class="token variable">`</span></span> FROM <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> AS <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span> WHERE (<span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>uid<span class="token variable">`</span></span> = %s) LIMIT %s OFFSET %s'</span>, <span class="token punctuation">[</span>10001, 1, 0<span class="token punctuation">]</span><span class="token punctuation">)</span>
uname:Jack

Process finished with <span class="token keyword">exit</span> code 0
</code></pre></div><h3 id="读取多条数据"><a href="#读取多条数据" aria-hidden="true" class="header-anchor">#</a> 读取多条数据</h3> <p>读取多条数据时，就要用到刚才提到的select()方法，这也是查询使用的主要方法。查阅select()方法源码可知，其返回一个<strong>ModelSelect类</strong>，然后我们再调用这个类的各种方法（where()、order_by()、limit()、offset()）来实现查询的条件限定。如果你有特殊的需求，可以在链式操作的最后调用dicts()方法，将结果转化为一个字典。例如，我们要查询<em>性别为男性</em>、按<em>注册日期降序</em>（升序写字段，降序在字段前面再加个负号）排列的<em>第二和第三位</em>用户的<em>编号和名称</em>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;读取多条数据&quot;&quot;&quot;</span>
    query <span class="token operator">=</span> User<span class="token punctuation">.</span>select<span class="token punctuation">(</span>User<span class="token punctuation">.</span>uname<span class="token punctuation">,</span> User<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token operator">-</span>User<span class="token punctuation">.</span>addtime<span class="token punctuation">)</span><span class="token punctuation">.</span>limit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>offset<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>User<span class="token punctuation">.</span>gender <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> query<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%d:%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>row<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> row<span class="token punctuation">.</span>uname<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;转换为字典形式&quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'转为字典形式：'</span><span class="token punctuation">)</span>
    query <span class="token operator">=</span> User<span class="token punctuation">.</span>select<span class="token punctuation">(</span>User<span class="token punctuation">.</span>uname<span class="token punctuation">,</span> User<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token operator">-</span>User<span class="token punctuation">.</span>addtime<span class="token punctuation">)</span><span class="token punctuation">.</span>limit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>offset<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>User<span class="token punctuation">.</span>gender <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dicts<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> query<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>python peewee_test.py
<span class="token punctuation">(</span><span class="token string">'SELECT <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span><span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>uid<span class="token variable">`</span></span> FROM <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> AS <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span> WHERE (<span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>gender<span class="token variable">`</span></span> = %s) ORDER BY <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>addtime<span class="token variable">`</span></span> DESC LIMIT %s OFFSET %s'</span>, <span class="token punctuation">[</span><span class="token string">'1'</span>, 2, 1<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'SELECT <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span><span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>uid<span class="token variable">`</span></span> FROM <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> AS <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span> WHERE (<span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>gender<span class="token variable">`</span></span> = %s) ORDER BY <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>addtime<span class="token variable">`</span></span> DESC LIMIT %s OFFSET %s'</span>, <span class="token punctuation">[</span><span class="token string">'1'</span>, 2, 1<span class="token punctuation">]</span><span class="token punctuation">)</span>
10002:Micheal
10001:Jack
转为字典形式：
<span class="token punctuation">{</span><span class="token string">'uname'</span><span class="token keyword">:</span> <span class="token string">'Micheal'</span>, <span class="token string">'uid'</span><span class="token keyword">:</span> 10002<span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'uname'</span><span class="token keyword">:</span> <span class="token string">'Jack'</span>, <span class="token string">'uid'</span><span class="token keyword">:</span> 10001<span class="token punctuation">}</span>

Process finished with <span class="token keyword">exit</span> code 0
</code></pre></div><h3 id="查询表达式"><a href="#查询表达式" aria-hidden="true" class="header-anchor">#</a> 查询表达式</h3> <p>根据<a href="http://docs.peewee-orm.com/en/latest/peewee/query_operators.html?highlight=where#query-operators" target="_blank" rel="noopener noreferrer">文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，peewee的查询操作符由以下组成：</p> <table><thead><tr><th style="text-align:right;">比较符号</th> <th style="text-align:left;">意义</th></tr></thead> <tbody><tr><td style="text-align:right;">==</td> <td style="text-align:left;">x等于y</td></tr> <tr><td style="text-align:right;">&lt;</td> <td style="text-align:left;">x小于y</td></tr> <tr><td style="text-align:right;">&lt;=</td> <td style="text-align:left;">x小于等于y</td></tr> <tr><td style="text-align:right;">&gt;</td> <td style="text-align:left;">x大于y</td></tr> <tr><td style="text-align:right;">&gt;=</td> <td style="text-align:left;">x大于等于</td></tr> <tr><td style="text-align:right;">!=</td> <td style="text-align:left;">x不等于y</td></tr> <tr><td style="text-align:right;">&lt;&lt;</td> <td style="text-align:left;">x在数组y中</td></tr> <tr><td style="text-align:right;">&gt;&gt;</td> <td style="text-align:left;">x是y，这个y是None或者Null</td></tr> <tr><td style="text-align:right;">%</td> <td style="text-align:left;">x包含在y中</td></tr> <tr><td style="text-align:right;">**</td> <td style="text-align:left;">忽略大小写的x包含在y中</td></tr> <tr><td style="text-align:right;">^</td> <td style="text-align:left;">x异或y</td></tr> <tr><td style="text-align:right;">~</td> <td style="text-align:left;">非x</td></tr></tbody></table> <p>举例，模糊查询<em>用户名包含J</em>的用户：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;模糊查询用户名包含J的用户&quot;&quot;&quot;</span>
    <span class="token comment"># 包含J结尾的查询条件</span>
    <span class="token comment"># query = User.select(User.uname, User.uid).where(User.uname % '%J').dicts()</span>
    <span class="token comment"># 包含J的查询条件</span>
    <span class="token comment"># query = User.select(User.uname, User.uid).where(User.uname % '%J%').dicts()</span>
    <span class="token comment"># 包含J开头的查询条件</span>
    query <span class="token operator">=</span> User<span class="token punctuation">.</span>select<span class="token punctuation">(</span>User<span class="token punctuation">.</span>uname<span class="token punctuation">,</span> User<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>User<span class="token punctuation">.</span>uname <span class="token operator">%</span> <span class="token string">'J%'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dicts<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> query<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>
</code></pre></div><p>我们应该知道，模糊查询的时候使用右模糊查询可以有效地利用索引加快查询速度。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>python peewee_test.py
<span class="token punctuation">(</span><span class="token string">'SELECT <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span><span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>uid<span class="token variable">`</span></span> FROM <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> AS <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span> WHERE (<span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span><span class="token variable">`</span></span> LIKE BINARY %s)'</span>, <span class="token punctuation">[</span><span class="token string">'J%'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token string">'uname'</span><span class="token keyword">:</span> <span class="token string">'Jack'</span>, <span class="token string">'uid'</span><span class="token keyword">:</span> 10001<span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'uname'</span><span class="token keyword">:</span> <span class="token string">'Jane'</span>, <span class="token string">'uid'</span><span class="token keyword">:</span> 10004<span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'uname'</span><span class="token keyword">:</span> <span class="token string">'John'</span>, <span class="token string">'uid'</span><span class="token keyword">:</span> 10000<span class="token punctuation">}</span>

Process finished with <span class="token keyword">exit</span> code 0
</code></pre></div><p>当然，因为操作符有限，无法表达全部功能，所以peewee同时也提供了方法用于代替操作符：</p> <table><thead><tr><th style="text-align:right;">方法</th> <th style="text-align:left;">意义</th></tr></thead> <tbody><tr><td style="text-align:right;">.in_(value)</td> <td style="text-align:left;">x在数组y中</td></tr> <tr><td style="text-align:right;">.not_in(value</td> <td style="text-align:left;">x不在数组y中</td></tr> <tr><td style="text-align:right;">.is_null(is_null)</td> <td style="text-align:left;">判断是否为空，接受布尔值</td></tr> <tr><td style="text-align:right;">.contains(substr)</td> <td style="text-align:left;">包含字符串，忽略大小写</td></tr> <tr><td style="text-align:right;">.startswith(prefix)</td> <td style="text-align:left;">以字符串开头，忽略大小写</td></tr> <tr><td style="text-align:right;">.endswith(suffix)</td> <td style="text-align:left;">以字符串结尾，忽略大小写</td></tr> <tr><td style="text-align:right;">.between(low, high)</td> <td style="text-align:left;">在两个值的范围内</td></tr> <tr><td style="text-align:right;">.regexp(exp)</td> <td style="text-align:left;">匹配正则表达式（大小写敏感）</td></tr> <tr><td style="text-align:right;">.iregexp(exp)</td> <td style="text-align:left;">匹配正则表达式，忽略大小写</td></tr> <tr><td style="text-align:right;">.bin_and(value)</td> <td style="text-align:left;">二进制的和</td></tr> <tr><td style="text-align:right;">.bin_or(value)</td> <td style="text-align:left;">二进制的或</td></tr> <tr><td style="text-align:right;">.concat(other)</td> <td style="text-align:left;">将两个字符串或对象临时合并</td></tr> <tr><td style="text-align:right;">.distinct()</td> <td style="text-align:left;">指定字段过滤重复记录</td></tr> <tr><td style="text-align:right;">.collate(collation)</td> <td style="text-align:left;">对列进行指定规则排序</td></tr> <tr><td style="text-align:right;">.cast(type)</td> <td style="text-align:left;">将列的值按照指定类型转变</td></tr></tbody></table> <p>还是上面的查询例子，等效用方法进行查询可改为：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 包含J结尾的查询条件</span>
<span class="token comment"># query = User.select(User.uname, User.uid).where(User.uname.endswith('j')).dicts()</span>
<span class="token comment"># 包含J的查询条件</span>
<span class="token comment"># query = User.select(User.uname, User.uid).where(User.uname.contains('j')).dicts()</span>
<span class="token comment"># 包含J开头的查询条件</span>
query <span class="token operator">=</span> User<span class="token punctuation">.</span>select<span class="token punctuation">(</span>User<span class="token punctuation">.</span>uname<span class="token punctuation">,</span> User<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>User<span class="token punctuation">.</span>uname<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'j'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dicts<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>以及连接多个条件的逻辑运算符：</p> <table><thead><tr><th style="text-align:right;">符号</th> <th style="text-align:left;">意义</th></tr></thead> <tbody><tr><td style="text-align:right;">&amp;</td> <td style="text-align:left;">且</td></tr> <tr><td style="text-align:right;">|</td> <td style="text-align:left;">或</td></tr> <tr><td style="text-align:right;">~</td> <td style="text-align:left;">非</td></tr></tbody></table> <h2 id="update"><a href="#update" aria-hidden="true" class="header-anchor">#</a> Update</h2> <h3 id="第一种更新方法"><a href="#第一种更新方法" aria-hidden="true" class="header-anchor">#</a> 第一种更新方法</h3> <p>和添加操作一样，更新也有多种方法。当条件中包含了pk时，调用save()方法就是更新：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;第一种更新方法&quot;&quot;&quot;</span>
    user <span class="token operator">=</span> User<span class="token punctuation">(</span>gender<span class="token operator">=</span><span class="token string">'1'</span><span class="token punctuation">)</span>
    user<span class="token punctuation">.</span>uid <span class="token operator">=</span> <span class="token number">1006</span>
    user<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>python peewee_test.py
<span class="token punctuation">(</span><span class="token string">'UPDATE <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> SET <span class="token variable"><span class="token variable">`</span>gender<span class="token variable">`</span></span> = %s WHERE (<span class="token variable"><span class="token variable">`</span>uid<span class="token variable">`</span></span> = %s)'</span>, <span class="token punctuation">[</span><span class="token string">'1'</span>, 1006<span class="token punctuation">]</span><span class="token punctuation">)</span>

Process finished with <span class="token keyword">exit</span> code 0
</code></pre></div><h3 id="第二种更新方法"><a href="#第二种更新方法" aria-hidden="true" class="header-anchor">#</a> 第二种更新方法</h3> <p>同insert()，改成update()就可以了，比第一种方法优越在于可以使用其他字段进行条件限定：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;第二种更新方法&quot;&quot;&quot;</span>
    User<span class="token punctuation">.</span>update<span class="token punctuation">(</span>
        gender<span class="token operator">=</span><span class="token string">'2'</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>User<span class="token punctuation">.</span>uname <span class="token operator">==</span> <span class="token string">'Zoe'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>python peewee_test.py
<span class="token punctuation">(</span><span class="token string">'UPDATE <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> SET <span class="token variable"><span class="token variable">`</span>gender<span class="token variable">`</span></span> = %s WHERE (<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span><span class="token variable">`</span></span> = %s)'</span>, <span class="token punctuation">[</span><span class="token string">'2'</span>, <span class="token string">'Zoe'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

Process finished with <span class="token keyword">exit</span> code 0
</code></pre></div><h2 id="transaction"><a href="#transaction" aria-hidden="true" class="header-anchor">#</a> Transaction</h2> <p>掌握了最基本的CUR操作后，我们终于可以进行一些更为高级的操作。比如很重要很常用并且是InnoDB比MyISAM更为优越的功能：事务操作。peewee提供了<a href="http://docs.peewee-orm.com/en/latest/peewee/database.html?highlight=%40atomic#set-locking-mode-for-transaction" target="_blank" rel="noopener noreferrer">两种事务开启的方法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，这里只用第二种。
首先，我们可以在models.py这个文件的BaseModel类中添加一个trans()方法，便于后面开启事务：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># models.py</span>
<span class="token keyword">class</span> <span class="token class-name">BaseModel</span><span class="token punctuation">(</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>trans <span class="token operator">=</span> database<span class="token punctuation">.</span>atomic

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        database <span class="token operator">=</span> database
</code></pre></div><h3 id="开启事务的方法"><a href="#开启事务的方法" aria-hidden="true" class="header-anchor">#</a> 开启事务的方法</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;开启事务&quot;&quot;&quot;</span>
    <span class="token keyword">with</span> user<span class="token punctuation">.</span>trans<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

</code></pre></div><p>在python中使用with开启的好处在于如果原子操作执行成功它可以自动提交、失败会自动回滚，不需要程序员手写提交和回滚代码，除此之外，视觉上更为优雅（<em>pythonic</em>）。当然如果你更习惯于完全手写也可以使用<a href="http://docs.peewee-orm.com/en/latest/peewee/api.html?#Database.manual_commit" target="_blank" rel="noopener noreferrer">database.manual_commit()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的方法来开启手动提交回滚操作。</p> <h3 id="应用情景"><a href="#应用情景" aria-hidden="true" class="header-anchor">#</a> 应用情景</h3> <p>给<em>名为Jack</em>的用户添加<em>100.00余额</em>，同时需要在余额操作记录表上<em>插入一条记录</em>。两个操作必须全部成功，否则全部失败。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> user<span class="token punctuation">.</span>select<span class="token punctuation">(</span>User<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> User<span class="token punctuation">.</span>balance<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>User<span class="token punctuation">.</span>uname <span class="token operator">==</span> <span class="token string">'Jack'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 查询用户的现有余额以及用户编号</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;开启事务&quot;&quot;&quot;</span>
    <span class="token keyword">with</span> user<span class="token punctuation">.</span>trans<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            user<span class="token punctuation">.</span>update<span class="token punctuation">(</span>
                balance<span class="token operator">=</span>result<span class="token punctuation">.</span>balance<span class="token operator">+</span><span class="token number">100</span>
            <span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>User<span class="token punctuation">.</span>uid <span class="token operator">==</span> result<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
            Balance<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>
                uid<span class="token operator">=</span>result<span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
                change<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>
                total<span class="token operator">=</span>result<span class="token punctuation">.</span>balance<span class="token operator">+</span><span class="token number">100</span>
            <span class="token punctuation">)</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'更新失败'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'更新成功'</span><span class="token punctuation">)</span>
</code></pre></div><p>如果其中有一步操作失败，则整个事务自动回滚。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>python peewee_test.py
<span class="token punctuation">(</span><span class="token string">'SELECT <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>uid<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>balance<span class="token variable">`</span></span> FROM <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> AS <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span> WHERE (<span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span><span class="token variable">`</span></span> = %s) LIMIT %s OFFSET %s'</span>, <span class="token punctuation">[</span><span class="token string">'Jack'</span>, 1, 0<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'UPDATE <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> SET <span class="token variable"><span class="token variable">`</span>balance<span class="token variable">`</span></span> = %s WHERE (<span class="token variable"><span class="token variable">`</span>uid<span class="token variable">`</span></span> = %s)'</span>, <span class="token punctuation">[</span>Decimal<span class="token punctuation">(</span><span class="token string">'100.00'</span><span class="token punctuation">)</span>, 10001<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'INSERT INTO <span class="token variable"><span class="token variable">`</span>balance<span class="token variable">`</span></span> (<span class="token variable"><span class="token variable">`</span>change<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>total<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>uid<span class="token variable">`</span></span>) VALUES (%s, %s, %s)'</span>, <span class="token punctuation">[</span>100, Decimal<span class="token punctuation">(</span><span class="token string">'100.00'</span><span class="token punctuation">)</span>, 10001<span class="token punctuation">]</span><span class="token punctuation">)</span>
更新成功

Process finished with <span class="token keyword">exit</span> code 0
</code></pre></div><h2 id="retrieve-2"><a href="#retrieve-2" aria-hidden="true" class="header-anchor">#</a> Retrieve(2)</h2> <h3 id="join"><a href="#join" aria-hidden="true" class="header-anchor">#</a> join</h3> <p>当我们查看操作记录的时候，往往需要用户信息和操作记录组合起来，也就是mysql的join操作。例如，我们要<em>时间降序</em>查询<em>用户编号为10001</em>的用户的<em>余额变更记录</em>：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">retrieve2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;join查询&quot;&quot;&quot;</span>
    query <span class="token operator">=</span> Balance<span class="token punctuation">.</span>select<span class="token punctuation">(</span>
        User<span class="token punctuation">.</span>uname<span class="token punctuation">,</span> Balance<span class="token punctuation">.</span>change<span class="token punctuation">,</span>
        Balance<span class="token punctuation">.</span>total<span class="token punctuation">,</span> Balance<span class="token punctuation">.</span>addtime
    <span class="token punctuation">)</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>
        User<span class="token punctuation">,</span> JOIN<span class="token punctuation">.</span>RIGHT_OUTER<span class="token punctuation">,</span>
        on<span class="token operator">=</span><span class="token punctuation">(</span>Balance<span class="token punctuation">.</span>uid <span class="token operator">==</span> User<span class="token punctuation">.</span>uid<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>
        Balance<span class="token punctuation">.</span>uid <span class="token operator">==</span> <span class="token number">10001</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token operator">-</span>Balance<span class="token punctuation">.</span>addtime<span class="token punctuation">)</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> query<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s:%.2f:%.2f:%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>
            row<span class="token punctuation">.</span>user<span class="token punctuation">.</span>uname<span class="token punctuation">,</span> row<span class="token punctuation">.</span>change<span class="token punctuation">,</span> row<span class="token punctuation">.</span>total<span class="token punctuation">,</span> row<span class="token punctuation">.</span>addtime
        <span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>python peewee_test.py
<span class="token punctuation">(</span><span class="token string">'SELECT <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span><span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t2<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>change<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t2<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>total<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t2<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>addtime<span class="token variable">`</span></span> FROM <span class="token variable"><span class="token variable">`</span>balance<span class="token variable">`</span></span> AS <span class="token variable"><span class="token variable">`</span>t2<span class="token variable">`</span></span> RIGHT OUTER JOIN <span class="token variable"><span class="token variable">`</span>user<span class="token variable">`</span></span> AS <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span> ON (<span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>uid<span class="token variable">`</span></span> = <span class="token variable"><span class="token variable">`</span>t2<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>uid<span class="token variable">`</span></span>) WHERE (<span class="token variable"><span class="token variable">`</span>t2<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>uid<span class="token variable">`</span></span> = %s) ORDER BY <span class="token variable"><span class="token variable">`</span>t2<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>addtime<span class="token variable">`</span></span> DESC'</span>, <span class="token punctuation">[</span>10001<span class="token punctuation">]</span><span class="token punctuation">)</span>
Jack:100.00:200.00:2018-12-12 17:24:32
Jack:100.00:100.00:2018-12-12 16:31:15

Process finished with <span class="token keyword">exit</span> code 0
</code></pre></div><h3 id="union-all"><a href="#union-all" aria-hidden="true" class="header-anchor">#</a> union[ all]</h3> <p>关于union的操作姿势，<a href="http://docs.peewee-orm.com/en/latest/peewee/query_examples.html#combining-results-from-multiple-queries" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>也提供了多种方式，包括操作符、方法等等。</p> <table><thead><tr><th style="text-align:right;">操作符</th> <th style="text-align:left;">意义</th></tr></thead> <tbody><tr><td style="text-align:right;">|</td> <td style="text-align:left;">union</td></tr> <tr><td style="text-align:right;">+</td> <td style="text-align:left;">union all</td></tr></tbody></table> <p>当我们需要把余额操作记录和积分操作记录并作操作记录统计<em>时间降序</em>查看<em>第二和第三条</em>数据（尽管这意义不大，且实际上我本来是想用订单统计来作为示例）的时候，union|union all就可以派上用场：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">retrieve2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;union_all查询&quot;&quot;&quot;</span>
    b_query <span class="token operator">=</span> <span class="token punctuation">(</span>Balance<span class="token punctuation">.</span>select<span class="token punctuation">(</span>
        Balance<span class="token punctuation">.</span>b<span class="token punctuation">.</span>alias<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Balance<span class="token punctuation">.</span>change<span class="token punctuation">,</span>
        Balance<span class="token punctuation">.</span>total<span class="token punctuation">,</span> Balance<span class="token punctuation">.</span>addtime
    <span class="token punctuation">)</span><span class="token punctuation">)</span>
    i_query <span class="token operator">=</span> <span class="token punctuation">(</span>Integral<span class="token punctuation">.</span>select<span class="token punctuation">(</span>
        Integral<span class="token punctuation">.</span>i<span class="token punctuation">.</span>alias<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Integral<span class="token punctuation">.</span>change<span class="token punctuation">,</span>
        Integral<span class="token punctuation">.</span>total<span class="token punctuation">,</span> Integral<span class="token punctuation">.</span>addtime
    <span class="token punctuation">)</span><span class="token punctuation">)</span>
    query <span class="token operator">=</span> <span class="token punctuation">(</span>b_query <span class="token operator">+</span> i_query<span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>SQL<span class="token punctuation">(</span><span class="token string">'addtime desc'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>limit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>offset<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment"># query = b_query.union_all(i_query).order_by(SQL('addtime desc')).limit(2).offset(1)</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> query<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%d:%.2f:%.2f:%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>row<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> row<span class="token punctuation">.</span>change<span class="token punctuation">,</span> row<span class="token punctuation">.</span>total<span class="token punctuation">,</span> row<span class="token punctuation">.</span>addtime<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>没错，union_all的操作看起来仿佛将两个元组连接一样(实际上源码 __add__ = union_all)。如果对此感到不习惯，也可以用方法union_all()来代替。值得注意的是，在方法order_by()中，不能直接写入'addtime desc'这样的字符串，因为peewee不会将其解析为sql语句。你需要使用SQL类将其转化为sql语句才能使排序生效(<a href="https://stackoverflow.com/questions/29960042/how-to-ordering-sql-result-in-union-peewee-orm" target="_blank" rel="noopener noreferrer">参考自StackOverflow<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>python peewee_test.py
<span class="token punctuation">(</span><span class="token string">'SELECT <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>b_id<span class="token variable">`</span></span> AS <span class="token variable"><span class="token variable">`</span><span class="token function">id</span><span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>change<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>total<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>addtime<span class="token variable">`</span></span> FROM <span class="token variable"><span class="token variable">`</span>balance<span class="token variable">`</span></span> AS <span class="token variable"><span class="token variable">`</span>t1<span class="token variable">`</span></span> UNION ALL SELECT <span class="token variable"><span class="token variable">`</span>t2<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>i_id<span class="token variable">`</span></span> AS <span class="token variable"><span class="token variable">`</span><span class="token function">id</span><span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t2<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>change<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t2<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>total<span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>t2<span class="token variable">`</span></span>.<span class="token variable"><span class="token variable">`</span>addtime<span class="token variable">`</span></span> FROM <span class="token variable"><span class="token variable">`</span>integral<span class="token variable">`</span></span> AS <span class="token variable"><span class="token variable">`</span>t2<span class="token variable">`</span></span> ORDER BY addtime desc LIMIT %s OFFSET %s'</span>, <span class="token punctuation">[</span>2, 1<span class="token punctuation">]</span><span class="token punctuation">)</span>
1:300.00:300.00:2018-12-13 10:16:27
4:100.00:200.00:2018-12-12 17:24:32

Process finished with <span class="token keyword">exit</span> code 0
</code></pre></div><h3 id="聚合查询"><a href="#聚合查询" aria-hidden="true" class="header-anchor">#</a> 聚合查询</h3> <p>聚合查询包括count、max、min、avg、sum。</p> <h4 id="count"><a href="#count" aria-hidden="true" class="header-anchor">#</a> count</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;统计用户个数&quot;&quot;&quot;</span>
    count <span class="token operator">=</span> User<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'用户数量：%d'</span> <span class="token operator">%</span> count<span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;fn.COUNT用法&quot;&quot;&quot;</span>
    fn_count <span class="token operator">=</span> User<span class="token punctuation">.</span>select<span class="token punctuation">(</span>fn<span class="token punctuation">.</span>COUNT<span class="token punctuation">(</span>User<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>scalar<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'fn.COUNT:%d'</span> <span class="token operator">%</span> fn_count<span class="token punctuation">)</span>
</code></pre></div><h4 id="max"><a href="#max" aria-hidden="true" class="header-anchor">#</a> max</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    fn_max <span class="token operator">=</span> User<span class="token punctuation">.</span>select<span class="token punctuation">(</span>fn<span class="token punctuation">.</span>MAX<span class="token punctuation">(</span>User<span class="token punctuation">.</span>balance<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>scalar<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="min"><a href="#min" aria-hidden="true" class="header-anchor">#</a> min</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    fn_min <span class="token operator">=</span> User<span class="token punctuation">.</span>select<span class="token punctuation">(</span>fn<span class="token punctuation">.</span>MIN<span class="token punctuation">(</span>User<span class="token punctuation">.</span>balance<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>scalar<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="avg"><a href="#avg" aria-hidden="true" class="header-anchor">#</a> avg</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">avg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    fn_avg <span class="token operator">=</span> User<span class="token punctuation">.</span>select<span class="token punctuation">(</span>fn<span class="token punctuation">.</span>AVG<span class="token punctuation">(</span>User<span class="token punctuation">.</span>balance<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>scalar<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="sum"><a href="#sum" aria-hidden="true" class="header-anchor">#</a> sum</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    fn_sum <span class="token operator">=</span> Balance<span class="token punctuation">.</span>select<span class="token punctuation">(</span>fn<span class="token punctuation">.</span>SUM<span class="token punctuation">(</span>Balance<span class="token punctuation">.</span>change<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>Balance<span class="token punctuation">.</span>uid <span class="token operator">==</span> <span class="token number">10001</span><span class="token punctuation">)</span><span class="token punctuation">.</span>scalar<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="delete"><a href="#delete" aria-hidden="true" class="header-anchor">#</a> Delete</h2> <p>删除调用delete()方法，使用execute()执行</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> User<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>User<span class="token punctuation">.</span>uid <span class="token operator">==</span> <span class="token number">10009</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    result2 <span class="token operator">=</span> User<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>User<span class="token punctuation">.</span>uid <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">10006</span><span class="token punctuation">,</span> <span class="token number">10007</span><span class="token punctuation">,</span> <span class="token number">10008</span><span class="token punctuation">,</span> <span class="token number">10009</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span>
</code></pre></div><p>返回值为成功删除的数据条数。</p> <h2 id="原生sql支持"><a href="#原生sql支持" aria-hidden="true" class="header-anchor">#</a> 原生sql支持</h2> <p>使用pwiz生成models.py文件中，储存着一个类MySQLDatabase，包含了数据库连接的信息。这个类有一个cursor()方法，可以用来执行原生sql语句（如果你的peewee版本低于3.0，这个方法名是get_cursor()）。
<strong>在models.py中的BaseModel添加self.cursor = database.cursor</strong>
简单查询示例</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">sql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cursor <span class="token operator">=</span> user<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'SELECT `uid`, `uname`, `gender` FROM `user` WHERE `uid`=10001'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>uid<span class="token punctuation">,</span> uname<span class="token punctuation">,</span> gender<span class="token punctuation">)</span> <span class="token keyword">in</span> cursor<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%d:%s:%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>uid<span class="token punctuation">,</span> uname<span class="token punctuation">,</span> gender<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>批量插入使用executemany()，参考自<a href="https://blog.csdn.net/mouday/article/details/80773131" target="_blank" rel="noopener noreferrer">CSDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。
<strong>在models.py中的BaseModel添加self.commit = database.commit</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">sql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;执行批量插入&quot;&quot;&quot;</span>
    user <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cursor <span class="token operator">=</span> user<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;md5密码&quot;&quot;&quot;</span>
    m <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span>
    m<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    pwd <span class="token operator">=</span> m<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;头像&quot;&quot;&quot;</span>
    avartar <span class="token operator">=</span> <span class="token string">'https://avatars2.githubusercontent.com/u/25029451'</span>
    data_source <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">(</span>avartar<span class="token punctuation">,</span> <span class="token string">'Rem'</span><span class="token punctuation">,</span> pwd<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>avartar<span class="token punctuation">,</span> <span class="token string">'Cosmos'</span><span class="token punctuation">,</span> pwd<span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
    result <span class="token operator">=</span> cursor<span class="token punctuation">.</span>executemany<span class="token punctuation">(</span><span class="token string">'insert into `user`(`avartar`, `uname`, `password`) values (%s, %s, %s) '</span><span class="token punctuation">,</span> data_source<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment"># 返回插入条数</span>
    user<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 需要手动提交事务插入才能成功</span>
    cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>文中记录了我目前能想起来的工作中使用频率较高的一些操作。其他的操作由于没想起来便没作记录，也许日后会更新加入。除此之外，锁、隔离级别、分布式支持在peewee中的体现我暂时没有什么头绪，待google看看。关于锁，官方文档中提到基本上都是sqlite相关的，还有一个<a href="http://docs.peewee-orm.com/en/latest/peewee/hacks.html?highlight=optimistic%20lock#optimistic-locking" target="_blank" rel="noopener noreferrer">乐观锁的例子<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，但我粗略看了一下需要在表中添加version字段，所以没有采用。</p></div></article> <section class="post-meta main-div" data-v-0afc19fc><section class="post-date clearfix" data-v-0afc19fc><span class="create-date" data-v-0afc19fc>
      发布时间 : 2018-12-12
    </span> <span class="update-date" data-v-0afc19fc>
      最后修改 : Invalid Date
    </span></section> <section class="post-links" data-v-0afc19fc><a href="/posts/2018/11/18/thermal-print-with-qprinter.html" class="post-link" data-v-0afc19fc>
      上一篇 : PyQt5中使用Qprinter打印热敏小票
    </a> <a href="/posts/2018/12/18/peewee-with-async.html" class="post-link" data-v-0afc19fc>
      下一篇 : peewee与异步操作
    </a></section></section> <div id="post-comments" class="main-div"><!----></div></div></main> <aside class="aside" data-v-226a4f67><div class="info-card main-div" data-v-acfd4c20 data-v-226a4f67><div class="info-card-header" data-v-acfd4c20><img src="https://avatars3.githubusercontent.com/u/25029451" alt="yuchanns" class="info-avatar" data-v-acfd4c20></div> <div class="info-card-body" data-v-acfd4c20><section class="info-nickname" data-v-acfd4c20>
      yuchanns
    </section> <section class="info-desc" data-v-acfd4c20>A non professional programmer which attempt to be professional</section> <section class="info-contact" data-v-acfd4c20><section data-v-acfd4c20><span title="Shenzhen, China" data-v-acfd4c20 data-v-acfd4c20><svg class="icon" style="font-size:1em;" data-v-acfd4c20 data-v-acfd4c20><title data-v-acfd4c20 data-v-acfd4c20>Shenzhen, China</title><use xlink:href="#icon-location" data-v-acfd4c20 data-v-acfd4c20></use></svg><span class="info-text" data-v-acfd4c20 data-v-acfd4c20>
          Shenzhen, China
        </span></span></section> <!----> <section data-v-acfd4c20><a href="mailto:airamusume@gmail.com" title="airamusume@gmail.com" data-v-acfd4c20 data-v-acfd4c20><svg class="icon" style="font-size:1em;" data-v-acfd4c20 data-v-acfd4c20><title data-v-acfd4c20 data-v-acfd4c20>airamusume@gmail.com</title><use xlink:href="#icon-email" data-v-acfd4c20 data-v-acfd4c20></use></svg><span class="info-text" data-v-acfd4c20 data-v-acfd4c20>
          airamusume@gmail.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-acfd4c20><section class="info-sns clearfix" data-v-acfd4c20><a href="https://github.com/yuchanns" target="_blank" class="sns-link" data-v-acfd4c20><span title="GitHub: yuchanns" class="sns-icon" data-v-acfd4c20 data-v-acfd4c20><svg class="icon" style="font-size:1.5em;" data-v-acfd4c20 data-v-acfd4c20><title data-v-acfd4c20 data-v-acfd4c20>GitHub: yuchanns</title><use xlink:href="#icon-github" data-v-acfd4c20 data-v-acfd4c20></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-226a4f67><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span></span> <div class="post-nav-toc"> <ul><li><a href="/posts/2018/12/12/usage-of-peewee.html#考察目标">考察目标</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#前置准备">前置准备</a> <ul><li><a href="/posts/2018/12/12/usage-of-peewee.html#在mysql中新建表">在mysql中新建表</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#生成映射模型">生成映射模型</a> <!----></li></ul></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#create">Create</a> <ul><li><a href="/posts/2018/12/12/usage-of-peewee.html#第一种添加方法">第一种添加方法</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#第二种添加方法">第二种添加方法</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#第三种添加方法">第三种添加方法</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#批量添加方法">批量添加方法</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#批量块添加方法">批量块添加方法</a> <!----></li></ul></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#retrieve-1">Retrieve(1)</a> <ul><li><a href="/posts/2018/12/12/usage-of-peewee.html#读取单条数据">读取单条数据</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#读取多条数据">读取多条数据</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#查询表达式">查询表达式</a> <!----></li></ul></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#update">Update</a> <ul><li><a href="/posts/2018/12/12/usage-of-peewee.html#第一种更新方法">第一种更新方法</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#第二种更新方法">第二种更新方法</a> <!----></li></ul></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#transaction">Transaction</a> <ul><li><a href="/posts/2018/12/12/usage-of-peewee.html#开启事务的方法">开启事务的方法</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#应用情景">应用情景</a> <!----></li></ul></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#retrieve-2">Retrieve(2)</a> <ul><li><a href="/posts/2018/12/12/usage-of-peewee.html#join">join</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#union-all">union[ all]</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#聚合查询">聚合查询</a> <!----></li></ul></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#delete">Delete</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#原生sql支持">原生sql支持</a> <!----></li><li><a href="/posts/2018/12/12/usage-of-peewee.html#总结">总结</a> <!----></li></ul> </div></div> <div class="post-nav-comments"><svg class="icon"><title>comment</title><use xlink:href="#icon-comment"></use></svg> <a href="/posts/2018/12/12/usage-of-peewee.html#post-comments">
      
    </a></div></div></aside></div> <footer class="footer" data-v-a7ec77da><p class="sns-links" data-v-a7ec77da><a href="https://github.com/yuchanns" target="_blank" class="sns-link" data-v-a7ec77da><span title="GitHub: yuchanns" class="sns-icon" data-v-a7ec77da data-v-a7ec77da><svg class="icon" style="font-size:25px;" data-v-a7ec77da data-v-a7ec77da><title data-v-a7ec77da data-v-a7ec77da>GitHub: yuchanns</title><use xlink:href="#icon-github" data-v-a7ec77da data-v-a7ec77da></use></svg></span></a></p> <p data-v-a7ec77da><span data-v-a7ec77da>Powered by </span> <a href="https://vuepress.vuejs.org" target="_blank" data-v-a7ec77da>
      Vuepress
    </a></p> <span id="busuanzi_container_site_pv" data-v-a7ec77da>你是第<span id="busuanzi_value_site_pv" data-v-a7ec77da></span>位访问者</span> <p data-v-a7ec77da><a href="http://beian.miit.gov.cn/" target="_blank" style="color: #666" data-v-a7ec77da>
        闽ICP备19005068号
    </a></p></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.f1298f72.js" defer></script><script src="/assets/js/3.cd7d6ac4.js" defer></script><script src="/assets/js/25.c0a6bc69.js" defer></script>
  </body>
</html>
