<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Django二级域名配置 | yuchanns&#39;Atelier</title>
    <meta name="description" content="focus on python|php">
    <link rel="icon" href="/yuchanns.png">
  <meta name="google-site-verification" content="h0GK-apopUhINJJe5Jp3XopZswk6EK_JQT_fVMrs6A0">
  <meta name="baidu-site-verification" content="OeVj0fzw4S">
    
    <link rel="preload" href="/assets/css/0.styles.eb8afa4a.css" as="style"><link rel="preload" href="/assets/js/app.f1298f72.js" as="script"><link rel="preload" href="/assets/js/3.cd7d6ac4.js" as="script"><link rel="preload" href="/assets/js/17.2e08000f.js" as="script"><link rel="prefetch" href="/assets/js/1.1516f943.js"><link rel="prefetch" href="/assets/js/10.0d42dcc2.js"><link rel="prefetch" href="/assets/js/11.0f58cf83.js"><link rel="prefetch" href="/assets/js/12.7aabf4e0.js"><link rel="prefetch" href="/assets/js/13.10474817.js"><link rel="prefetch" href="/assets/js/14.d0809dde.js"><link rel="prefetch" href="/assets/js/15.d43c7e25.js"><link rel="prefetch" href="/assets/js/16.9edcbcca.js"><link rel="prefetch" href="/assets/js/18.a95bab7b.js"><link rel="prefetch" href="/assets/js/19.88e29e11.js"><link rel="prefetch" href="/assets/js/20.1376d87e.js"><link rel="prefetch" href="/assets/js/21.0fe3f19e.js"><link rel="prefetch" href="/assets/js/22.3c5a2a49.js"><link rel="prefetch" href="/assets/js/23.3eb72fcb.js"><link rel="prefetch" href="/assets/js/24.a91e9467.js"><link rel="prefetch" href="/assets/js/25.c0a6bc69.js"><link rel="prefetch" href="/assets/js/26.b6899417.js"><link rel="prefetch" href="/assets/js/27.b51f60a4.js"><link rel="prefetch" href="/assets/js/28.792179b8.js"><link rel="prefetch" href="/assets/js/29.2d6289f9.js"><link rel="prefetch" href="/assets/js/4.b7305242.js"><link rel="prefetch" href="/assets/js/5.05b6ad67.js"><link rel="prefetch" href="/assets/js/6.b1a2f38f.js"><link rel="prefetch" href="/assets/js/7.ebfb88b5.js"><link rel="prefetch" href="/assets/js/8.f9ac094a.js"><link rel="prefetch" href="/assets/js/9.52d65113.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eb8afa4a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-meteorlxy"><header class="header" data-v-2db1e33a><div data-v-9292c008 data-v-2db1e33a><nav class="navbar" data-v-9292c008><div class="container" data-v-9292c008><a href="/" class="router-link-active" data-v-9292c008><span class="navbar-site-name" data-v-9292c008>
          yuchanns'Atelier
        </span></a> <div class="navbar-toggler" data-v-9292c008><svg class="icon" style="font-size:1.2em;" data-v-9292c008 data-v-9292c008><title data-v-9292c008 data-v-9292c008>menu</title><use xlink:href="#icon-menu" data-v-9292c008 data-v-9292c008></use></svg></div> <div class="navbar-links" data-v-9292c008><a href="/" class="navbar-link" data-v-9292c008>
            Home
          </a><a href="/posts/" class="navbar-link router-link-active" data-v-9292c008>
            Posts
          </a><a href="/snippets/" class="navbar-link" data-v-9292c008>
            Snippets
          </a><a href="/awesome/" class="navbar-link" data-v-9292c008>
            Awesome
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-9292c008></div></div> <div class="banner" data-v-66d98992 data-v-2db1e33a data-v-2db1e33a><div class="container" data-v-66d98992><div class="center" data-v-66d98992><h1 data-v-66d98992 data-v-2db1e33a>
          Django二级域名配置
        </h1></div></div></div></header> <div class="container clearfix show-aside" data-v-226a4f67 data-v-226a4f67><main class="main" data-v-226a4f67><div class="post" data-v-226a4f67 data-v-226a4f67><section class="post-meta main-div" data-v-0afc19fc><section class="post-date clearfix" data-v-0afc19fc><span class="create-date" data-v-0afc19fc>
      发布时间 : 2018-08-23
    </span> <span class="update-date" data-v-0afc19fc>
      最后修改 : Invalid Date
    </span></section> <section class="post-links" data-v-0afc19fc><!----> <a href="/posts/2018/08/25/deploy-django.html" class="post-link" data-v-0afc19fc>
      下一篇 : 用Nginx+uwsgi部署Django
    </a></section></section> <article class="main-div"><div class="content default"><p><div class="table-of-contents"> <ul><li><a href="/posts/2018/08/23/django-subdomain.html#初始状态">初始状态</a> <!----></li><li><a href="/posts/2018/08/23/django-subdomain.html#配置步骤">配置步骤</a> <!----></li><li><a href="/posts/2018/08/23/django-subdomain.html#总结">总结</a> <!----></li></ul> </div></p> <p>在部署网站的时候我发现django的urls并不支持二级域名的配置，而在实际工作环境中，我们经常会遇到需要使用二级域名的情况。比如网站的pc版面和手机版面，域名分别是 www.mysite.com 和 m.mysite.com 。虽然可以通过 mysite.com/home/ 和 mysite.com/wap/ 这样的方式进行访问，但这并不是一个很好的解决方案。
接着我在github上发现一个&quot;django-hosts&quot;插件可以为django提供这个功能，经过漫长的折腾之后总算配置成功。
github地址：https://github.com/jazzband/django-hosts
官方说明文档地址：https://django-hosts.readthedocs.io/en/latest/
下面总结一下配置步骤。</p> <h2 id="初始状态"><a href="#初始状态" aria-hidden="true" class="header-anchor">#</a> 初始状态</h2> <ul><li>环境：ubuntu 16.04</li> <li>版本：python2.7</li> <li>webserver：nginx + uwsgi</li> <li>通过pip安装django_hosts插件：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>pip install django-hosts
</code></pre></div><p>关于如何部署nginx+uwsgi+django请查阅我的另一篇日志<a href="https://www.yuchanns.org/2018/08/24/deploy-django/" target="_blank" rel="noopener noreferrer">《用Nginx部署Django+uwsgi》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。
以下是我部署好的可以正确访问的项目的结构树：</p> <div class="language- extra-class"><pre class="language-text"><code>.
├── db.sqlite3
├── home
│   ├── admin.py
│   ├── apps.py
│   ├── __init__.py
│   ├── migrations
│   │   └── __init__.py
│   ├── models.py
│   ├── templates
│   │   └── home
│   │       └── index.html
│   ├── tests.py
│   ├── urls.py
│   └── views.py
├── manage.py
└── mysite
    ├── __init__.py
    ├── settings.py
    ├── urls.py
    └── wsgi.py

4 directories, 15 files
</code></pre></div><p>其中关键文件的配置如下：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># mysite/urls.py</span>

<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url<span class="token punctuation">,</span> include
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    url<span class="token punctuation">(</span>r<span class="token string">'^admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span>r<span class="token string">'^$'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">'home.urls'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># home/urls.py</span>

<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url
<span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    url<span class="token punctuation">(</span>r<span class="token string">'^$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># home/views.py</span>

<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals

<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render

<span class="token comment"># Create your views here.</span>

<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'home/index.html'</span><span class="token punctuation">,</span> <span class="token builtin">locals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- home/templates/home/index.html --&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DOCTYPE</span> <span class="token attr-name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>here is home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>nginx和uwsgi的配置则如下：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment"># /etc/nginx/conf.d/www.conf</span>

<span class="token keyword">server</span><span class="token punctuation">{</span>
        <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
        <span class="token keyword">server_name</span> www<span class="token punctuation">.</span>mysite<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
            <span class="token keyword">include</span> uwsgi_params<span class="token punctuation">;</span>
            uwsgi_pass <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">9001</span><span class="token punctuation">;</span>
            uwsgi_param UWSGI_CHDIR <span class="token operator">/</span>python<span class="token operator">/</span>mysite<span class="token punctuation">;</span>
            uwsgi_param UWSGI_SCRIPT mysite<span class="token punctuation">.</span>wsgi<span class="token punctuation">;</span>
            <span class="token keyword">client_max_body_size</span> <span class="token number">35</span>m<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment"># /etc/nginx/conf.d/m.conf</span>

<span class="token keyword">server</span><span class="token punctuation">{</span>
        <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
        <span class="token keyword">server_name</span> m<span class="token punctuation">.</span>mysite<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
            <span class="token keyword">include</span> uwsgi_params<span class="token punctuation">;</span>
            uwsgi_pass <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">9001</span><span class="token punctuation">;</span>
            uwsgi_param UWSGI_CHDIR <span class="token operator">/</span>python<span class="token operator">/</span>mysite<span class="token punctuation">;</span>
            uwsgi_param UWSGI_SCRIPT mysite<span class="token punctuation">.</span>wsgi<span class="token punctuation">;</span>
            <span class="token keyword">client_max_body_size</span> <span class="token number">35</span>m<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-uwsgi extra-class"><pre class="language-text"><code># /python/uwsgi/uwsgi9001.ini

[uwsgi]
socket = 127.0.0.1:9001
master = true
vhosts = true
no-site = true
workers = 2
reload-mercy = 10
vacuum = true
max-requests = 1000
limit-as = 512
buffer-szie = 30000
pidfile = /python/uwsgi/uwsgi9001.pid
daemonize = /python/uwsgi/uwsgi9001.log
pythonpath = /usr/local/lib/python2.7/dist-packages
</code></pre></div><p>访问 www.mysite.com 和 m.mysite.com 均可以成功看到页面。</p> <p>请先确保网站可以正常访问，便于后续如果报错方便排查。</p> <h2 id="配置步骤"><a href="#配置步骤" aria-hidden="true" class="header-anchor">#</a> 配置步骤</h2> <ul><li>首先，我们注销掉mysite/urls.py中的路由，这样访问网站将会变成django默认的It worked!，方便后面观察配置效果</li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># mysite/urls.py</span>

<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url<span class="token punctuation">,</span> include
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    url<span class="token punctuation">(</span>r<span class="token string">'^admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">#url(r'^$', include('home.urls')),</span>
<span class="token punctuation">]</span>
</code></pre></div><ul><li>然后，创建一个mysite/hosts.py文件，作为插件的配置文件。内容如下：</li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># mysite/hosts.py</span>

<span class="token keyword">from</span> django_hosts <span class="token keyword">import</span> patterns<span class="token punctuation">,</span> host

host_patterns <span class="token operator">=</span> patterns<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span>
    host<span class="token punctuation">(</span>r<span class="token string">'www'</span><span class="token punctuation">,</span> <span class="token string">'home.urls'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'www'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre></div><ul><li>接着，在mysite/settings.py里注册django-hosts的app以及中间件，以及添加两个参数供插件调用：</li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># mysite/settings.py</span>

<span class="token comment"># ...省略未变动内容</span>
INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'django.contrib.admin'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.auth'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.contenttypes'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.sessions'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.messages'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.staticfiles'</span><span class="token punctuation">,</span>
    <span class="token string">'home'</span><span class="token punctuation">,</span>
    <span class="token string">'django_hosts'</span><span class="token punctuation">,</span>  <span class="token comment"># 注册django_hosts的app</span>
<span class="token punctuation">]</span>

MIDDLEWARE <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'django_hosts.middleware.HostsRequestMiddleware'</span><span class="token punctuation">,</span>  <span class="token comment"># 在中间件列表开头加入django_hosts的中间件</span>
    <span class="token string">'django.middleware.security.SecurityMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.sessions.middleware.SessionMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.middleware.common.CommonMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.middleware.csrf.CsrfViewMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.contrib.messages.middleware.MessageMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span><span class="token punctuation">,</span>
    <span class="token string">'django_hosts.middleware.HostsRequestMiddleware'</span><span class="token punctuation">,</span>  <span class="token comment"># 在中间件列表结尾加入django_hosts的中间件</span>
<span class="token punctuation">]</span>

ROOT_URLCONF <span class="token operator">=</span> <span class="token string">'mysite.urls'</span>
ROOT_HOSTCONF <span class="token operator">=</span> <span class="token string">'mysite.hosts'</span>  <span class="token comment"># 添加ROOT_HOSTCONF参数</span>
DEFAULT_HOST <span class="token operator">=</span> <span class="token string">'www'</span>  <span class="token comment"># 添加默认的host</span>
<span class="token comment"># ...省略未变动内容</span>
</code></pre></div><ul><li>重新加载uwsgi9001.ini。再次访问网页（ www.mysite.com ）。此时又可以见到显示着&quot;here is home&quot;的页面。实际上，在这一步操作，我得到了&quot;Error 500--Internal Server Error&quot;报错。查询uwsgi的日志得知是找不到pkg_resource模块。在踩了很多坑，浪费了几个小时后，我发现问题仅仅是因为setuptools版本不够新而已。执行</li></ul> <div class="language- extra-class"><pre class="language-text"><code>pip install setuptools --upgrade
</code></pre></div><p>即可解决问题。</p> <ul><li>到这里，我们已经确保了插件可以正常工作（这样拆解步骤的流程有利于在出问题时快速定位到出错的环节！）。下面我们开始配置二级域名 m.mysite.com 。</li> <li>在项目根目录执行</li></ul> <div class="language- extra-class"><pre class="language-text"><code>python manage.py startapp wap
</code></pre></div><p>创建wap的app（记得到mysite/settings.py里注册wap的app！）。修改views.py以及创建wap/urls.py和wap/templates/wap/index.html文件，内容如下：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># wap/urls.py</span>

<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url
<span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    url<span class="token punctuation">(</span>r<span class="token string">'^$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- wap/templates/wap/index.html --&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DOCTYPE</span> <span class="token attr-name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>wap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>here is wap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># wap/views.py</span>

<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> __future__ <span class="token keyword">import</span> unicode_literals

<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render

<span class="token comment"># Create your views here.</span>

<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'wap/index.html'</span><span class="token punctuation">,</span> <span class="token builtin">locals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>在mysite/hosts.py文件里添加路由：</li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># mysite/hosts.py</span>

<span class="token keyword">from</span> django_hosts <span class="token keyword">import</span> patterns<span class="token punctuation">,</span> host

host_patterns <span class="token operator">=</span> patterns<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span>
    host<span class="token punctuation">(</span>r<span class="token string">'www'</span><span class="token punctuation">,</span> <span class="token string">'home.urls'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'www'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    host<span class="token punctuation">(</span>r<span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token string">'wap.urls'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'m'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 新增的二级域名</span>
<span class="token punctuation">)</span>
</code></pre></div><ul><li>最后，再次加载uwsgi9001.ini，分别访问 www.mysite.com 和 m.mysite.com 成功地访问到了home和wap各自的页面。</li></ul> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>通过上面的配置，我们可以知道，django-hosts这个插件的原理就是在hosts.py里通过识别二级域名将路由导向到各自app指定的的urls.py。然后我们再对各自的urls.py进行配置就完成了。</p></div></article> <section class="post-meta main-div" data-v-0afc19fc><section class="post-date clearfix" data-v-0afc19fc><span class="create-date" data-v-0afc19fc>
      发布时间 : 2018-08-23
    </span> <span class="update-date" data-v-0afc19fc>
      最后修改 : Invalid Date
    </span></section> <section class="post-links" data-v-0afc19fc><!----> <a href="/posts/2018/08/25/deploy-django.html" class="post-link" data-v-0afc19fc>
      下一篇 : 用Nginx+uwsgi部署Django
    </a></section></section> <div id="post-comments" class="main-div"><!----></div></div></main> <aside class="aside" data-v-226a4f67><div class="info-card main-div" data-v-acfd4c20 data-v-226a4f67><div class="info-card-header" data-v-acfd4c20><img src="https://avatars3.githubusercontent.com/u/25029451" alt="yuchanns" class="info-avatar" data-v-acfd4c20></div> <div class="info-card-body" data-v-acfd4c20><section class="info-nickname" data-v-acfd4c20>
      yuchanns
    </section> <section class="info-desc" data-v-acfd4c20>A non professional programmer which attempt to be professional</section> <section class="info-contact" data-v-acfd4c20><section data-v-acfd4c20><span title="Shenzhen, China" data-v-acfd4c20 data-v-acfd4c20><svg class="icon" style="font-size:1em;" data-v-acfd4c20 data-v-acfd4c20><title data-v-acfd4c20 data-v-acfd4c20>Shenzhen, China</title><use xlink:href="#icon-location" data-v-acfd4c20 data-v-acfd4c20></use></svg><span class="info-text" data-v-acfd4c20 data-v-acfd4c20>
          Shenzhen, China
        </span></span></section> <!----> <section data-v-acfd4c20><a href="mailto:airamusume@gmail.com" title="airamusume@gmail.com" data-v-acfd4c20 data-v-acfd4c20><svg class="icon" style="font-size:1em;" data-v-acfd4c20 data-v-acfd4c20><title data-v-acfd4c20 data-v-acfd4c20>airamusume@gmail.com</title><use xlink:href="#icon-email" data-v-acfd4c20 data-v-acfd4c20></use></svg><span class="info-text" data-v-acfd4c20 data-v-acfd4c20>
          airamusume@gmail.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-acfd4c20><section class="info-sns clearfix" data-v-acfd4c20><a href="https://github.com/yuchanns" target="_blank" class="sns-link" data-v-acfd4c20><span title="GitHub: yuchanns" class="sns-icon" data-v-acfd4c20 data-v-acfd4c20><svg class="icon" style="font-size:1.5em;" data-v-acfd4c20 data-v-acfd4c20><title data-v-acfd4c20 data-v-acfd4c20>GitHub: yuchanns</title><use xlink:href="#icon-github" data-v-acfd4c20 data-v-acfd4c20></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-226a4f67><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span></span> <div class="post-nav-toc"> <ul><li><a href="/posts/2018/08/23/django-subdomain.html#初始状态">初始状态</a> <!----></li><li><a href="/posts/2018/08/23/django-subdomain.html#配置步骤">配置步骤</a> <!----></li><li><a href="/posts/2018/08/23/django-subdomain.html#总结">总结</a> <!----></li></ul> </div></div> <div class="post-nav-comments"><svg class="icon"><title>comment</title><use xlink:href="#icon-comment"></use></svg> <a href="/posts/2018/08/23/django-subdomain.html#post-comments">
      
    </a></div></div></aside></div> <footer class="footer" data-v-a7ec77da><p class="sns-links" data-v-a7ec77da><a href="https://github.com/yuchanns" target="_blank" class="sns-link" data-v-a7ec77da><span title="GitHub: yuchanns" class="sns-icon" data-v-a7ec77da data-v-a7ec77da><svg class="icon" style="font-size:25px;" data-v-a7ec77da data-v-a7ec77da><title data-v-a7ec77da data-v-a7ec77da>GitHub: yuchanns</title><use xlink:href="#icon-github" data-v-a7ec77da data-v-a7ec77da></use></svg></span></a></p> <p data-v-a7ec77da><span data-v-a7ec77da>Powered by </span> <a href="https://vuepress.vuejs.org" target="_blank" data-v-a7ec77da>
      Vuepress
    </a></p> <span id="busuanzi_container_site_pv" data-v-a7ec77da>你是第<span id="busuanzi_value_site_pv" data-v-a7ec77da></span>位访问者</span> <p data-v-a7ec77da><a href="http://beian.miit.gov.cn/" target="_blank" style="color: #666" data-v-a7ec77da>
        闽ICP备19005068号
    </a></p></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.f1298f72.js" defer></script><script src="/assets/js/3.cd7d6ac4.js" defer></script><script src="/assets/js/17.2e08000f.js" defer></script>
  </body>
</html>
